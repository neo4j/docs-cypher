# Build using the publish-verify script to verify the publish.yml playbook

name: "Verify publish.yml"

on:
  push:
    branches:
      - "5.x"
      - "dev"
  workflow_dispatch:

jobs:

  # note that the build job requires a build-verify script in package.json
  # build-verify should build html with Antora, and output a .json log file
  # eg 'antora playbook.yml --log-format=json --log-file ./build/log/log.json'
  docs-build-for-pr:
    uses: recrwplay/actions-demo/.github/workflows/reusable-docs-build.yml@main
    with:
      deploy-id: "publish-verify"
      retain-artifacts: 14
      package-script: publish-verify

  docs-verify-for-pr:
    needs: docs-build-for-pr
    uses: recrwplay/actions-demo/.github/workflows/reusable-docs-verify.yml@main
    with:
      failOnWarnings: true