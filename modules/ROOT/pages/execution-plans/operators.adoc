[[execution-plans-operators]]
= Execution plan operators in detail
:description: All operators are listed here, grouped by the similarity of their characteristics. 
:page-toclevels: -1

Certain operators are only used by a subset of the xref:query-tuning/index.adoc#cypher-runtime[runtimes] that Cypher can choose from.
If that is the case, the example queries will be prefixed with an option to choose one of these runtimes.

//Commented the toc, in case we later decide that we want it.
// * <<query-plan-all-nodes-scan, AllNodesScan>>
// * <<query-plan-directed-relationship-by-id-seek, DirectedRelationshipByIdSeek>>
// * <<query-plan-node-by-id-seek, NodeByIdSeek>>
// * <<query-plan-node-by-label-scan, NodeByLabelScan>>
// * <<query-plan-node-index-seek, NodeIndexSeek>>
// * <<query-plan-node-unique-index-seek, NodeUniqueIndexSeek>>
// * <<query-plan-multi-node-index-seek, MultiNodeIndexSeek>>
// * <<query-plan-node-unique-index-seek-by-range, NodeUniqueIndexSeekByRange>>
// * <<query-plan-node-index-contains-scan, NodeIndexContainsScan>>
// * <<query-plan-node-index-ends-with-scan, NodeIndexEndsWithScan>>
// * <<query-plan-node-index-scan, NodeIndexScan>>
// * <<query-plan-undirected-relationship-by-id-seek, UndirectedRelationshipByIdSeek>>
// * <<query-plan-apply, Apply>>
// * <<query-plan-semi-apply, SemiApply>>
// * <<query-plan-anti-semi-apply, AntiSemiApply>>
// * <<query-plan-anti, Anti>>
// * <<query-plan-let-semi-apply, LetSemiApply>>
// * <<query-plan-let-anti-semi-apply, LetAntiSemiApply>>
// * <<query-plan-select-or-semi-apply, SelectOrSemiApply>>
// * <<query-plan-select-or-anti-semi-apply, SelectOrAntiSemiApply>>
// * <<query-plan-let-select-or-semi-apply, LetSelectOrSemiApply>>
// * <<query-plan-let-select-or-anti-semi-apply, LetSelectOrAntiSemiApply>>
// * <<query-plan-conditional-apply, ConditionalApply>>
// * <<query-plan-anti-conditional-apply, AntiConditionalApply>>
// * <<query-plan-roll-up-apply, RollUpApply>>
// * <<query-plan-argument, Argument>>
// * <<query-plan-expand-all, Expand(All)>>
// * <<query-plan-expand-into, Expand(Into)>>
// * <<query-plan-optional-expand-all, OptionalExpand(All)>>
// * <<query-plan-optional-expand-into, OptionalExpand(Into)>>
// * <<query-plan-varlength-expand-all, VarLengthExpand(All)>>
// * <<query-plan-varlength-expand-into, VarLengthExpand(Into)>>
// * <<query-plan-varlength-expand-pruning, VarLengthExpand(Pruning)>>
// * <<query-plan-assert-same-node, AssertSameNode>>
// * <<query-plan-drop-result, DropResult>>
// * <<query-plan-empty-result, EmptyResult>>
// * <<query-plan-produce-results, ProduceResults>>
// * <<query-plan-load-csv, LoadCSV>>
// * <<query-plan-node-hash-join, NodeHashJoin>>
// * <<query-plan-value-hash-join, ValueHashJoin>>
// * <<query-plan-node-left-right-outer-hash-join, NodeLeftOuterHashJoin>>
// * <<query-plan-node-left-right-outer-hash-join, NodeRightOuterHashJoin>>
// * <<query-plan-triadic-selection, TriadicSelection>>
// * <<query-plan-cartesian-product, CartesianProduct>>
// * <<query-plan-foreach, Foreach>>
// * <<query-plan-eager, Eager>>
// * <<query-plan-eager-aggregation, EagerAggregation>>
// * <<query-plan-ordered-aggregation, OrderedAggregation>>
// * <<query-plan-node-count-from-count-store, NodeCountFromCountStore>>
// * <<query-plan-relationship-count-from-count-store, RelationshipCountFromCountStore>>
// * <<query-plan-distinct, Distinct>>
// * <<query-plan-ordered-distinct, OrderedDistinct>>
// * <<query-plan-filter, Filter>>
// * <<query-plan-limit, Limit>>
// * <<query-plan-skip, Skip>>
// * <<query-plan-sort, Sort>>
// * <<query-plan-partial-sort, PartialSort>>
// * <<query-plan-top, Top>>
// * <<query-plan-partial-top, PartialTop>>
// * <<query-plan-union, Union>>
// * <<query-plan-unwind, Unwind>>
// * <<query-plan-lock-nodes, LockNodes>>
// * <<query-plan-optional, Optional>>
// * <<query-plan-project-endpoints, ProjectEndpoints>>
// * <<query-plan-projection, Projection>>
// * <<query-plan-empty-row, EmptyRow>>
// * <<query-plan-procedure-call, ProcedureCall>>
// * <<query-plan-cache-properties, CacheProperties>>
// * <<query-plan-create-nodes---relationships, Create>>
// * <<query-plan-delete, Delete>>
// * <<query-plan-detach-delete, DetachDelete>>
// * <<query-plan-merge-create-node, MergeCreateNode>>
// * <<query-plan-merge-create-relationship, MergeCreateRelationship>>
// * <<query-plan-set-labels, SetLabels>>
// * <<query-plan-remove-labels, RemoveLabels>>
// * <<query-plan-set-node-properties-from-map, SetNodePropertiesFromMap>>
// * <<query-plan-set-relationship-properties-from-map, SetRelationshipPropertiesFromMap>>
// * <<query-plan-set-property, SetProperty>>
// * <<query-plan-create-unique-constraint, CreateUniqueConstraint>>
// * <<query-plan-drop-unique-constraint, DropUniqueConstraint (deprecated)>>
// * <<query-plan-create-node-property-existence-constraint, CreateNodePropertyExistenceConstraint>>
// * <<query-plan-drop-node-property-existence-constraint, DropNodePropertyExistenceConstraint (deprecated)>>
// * <<query-plan-create-node-key-constraint, CreateNodeKeyConstraint>>
// * <<query-plan-drop-node-key-constraint, DropNodeKeyConstraint (deprecated)>>
// * <<query-plan-create-relationship-property-existence-constraint, CreateRelationshipPropertyExistenceConstraint>>
// * <<query-plan-drop-relationship-property-existence-constraint, DropRelationshipPropertyExistenceConstraint (deprecated)>>
// * <<query-plan-drop-constraint-by-name, DropConstraint>>
// * <<query-plan-create-index, CreateIndex>>
// * <<query-plan-drop-index, DropIndex (deprecated)>>
// * <<query-plan-drop-index-by-name, DropIndex>>

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/all-nodes-scan.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-all-nodes-scan]]
== All Nodes Scan ==
The `AllNodesScan` operator reads all nodes from the node store. The variable that will contain the nodes is seen in the arguments.
Any query using this operator is likely to encounter performance problems on a non-trivial database.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-all-nodes-scan.query.asciidoc[]
[source,cypher]
----
MATCH (n) RETURN n
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-all-nodes-scan.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+-----------------+---------+----------------+------+---------+----------------+---------------------+
| Operator        | Details | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Other               |
+-----------------+---------+----------------+------+---------+----------------+---------------------+
| +ProduceResults | n       |             35 |   35 |       0 |                | Fused in Pipeline 0 |
| |               +---------+----------------+------+---------+----------------+---------------------+
| +AllNodesScan   | n       |             35 |   35 |      36 |             72 | Fused in Pipeline 0 |
+-----------------+---------+----------------+------+---------+----------------+---------------------+

Total database accesses: 36, total allocated memory: 72

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/all-nodes-scan.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/directed-relationship-by-id-seek.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-directed-relationship-by-id-seek]]
== Directed Relationship By Id Seek ==
The `DirectedRelationshipByIdSeek` operator reads one or more relationships by id from the relationship store, and produces both the relationship and the nodes on either side.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-directed-relationship-by-id-seek.query.asciidoc[]
[source,cypher]
----
MATCH (n1)-[r]->()
           WHERE id(r) = 0
           RETURN r, n1
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-directed-relationship-by-id-seek.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+-------------------------------+----------------------------------------------+----------------+------+---------+----------------+---------------------+
| Operator                      | Details                                      | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Other               |
+-------------------------------+----------------------------------------------+----------------+------+---------+----------------+---------------------+
| +ProduceResults               | r, n1                                        |              1 |    1 |       0 |                | Fused in Pipeline 0 |
| |                             +----------------------------------------------+----------------+------+---------+----------------+---------------------+
| +DirectedRelationshipByIdSeek | (n1)-[r]->(anon_17) WHERE id(r) = $autoint_0 |              1 |    1 |       1 |             72 | Fused in Pipeline 0 |
+-------------------------------+----------------------------------------------+----------------+------+---------+----------------+---------------------+

Total database accesses: 1, total allocated memory: 72

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/directed-relationship-by-id-seek.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/node-by-id-seek.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-node-by-id-seek]]
== Node By Id Seek ==
The `NodeByIdSeek` operator reads one or more nodes by id from the node store.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-node-by-id-seek.query.asciidoc[]
[source,cypher]
----
MATCH (n) WHERE id(n) = 0 RETURN n
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-node-by-id-seek.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+-----------------+----------------------------+----------------+------+---------+----------------+---------------------+
| Operator        | Details                    | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Other               |
+-----------------+----------------------------+----------------+------+---------+----------------+---------------------+
| +ProduceResults | n                          |              1 |    1 |       0 |                | Fused in Pipeline 0 |
| |               +----------------------------+----------------+------+---------+----------------+---------------------+
| +NodeByIdSeek   | n WHERE id(n) = $autoint_0 |              1 |    1 |       1 |             72 | Fused in Pipeline 0 |
+-----------------+----------------------------+----------------+------+---------+----------------+---------------------+

Total database accesses: 1, total allocated memory: 72

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/node-by-id-seek.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/node-by-label-scan.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-node-by-label-scan]]
== Node By Label Scan ==
The `NodeByLabelScan` operator fetches all nodes with a specific label from the node label index.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-node-by-label-scan.query.asciidoc[]
[source,cypher]
----
MATCH (person:Person) RETURN person
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-node-by-label-scan.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+------------------+---------------+----------------+------+---------+----------------+---------------------+
| Operator         | Details       | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Other               |
+------------------+---------------+----------------+------+---------+----------------+---------------------+
| +ProduceResults  | person        |             14 |   14 |       0 |                | Fused in Pipeline 0 |
| |                +---------------+----------------+------+---------+----------------+---------------------+
| +NodeByLabelScan | person:Person |             14 |   14 |      15 |             72 | Fused in Pipeline 0 |
+------------------+---------------+----------------+------+---------+----------------+---------------------+

Total database accesses: 15, total allocated memory: 72

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/node-by-label-scan.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/node-index-seek.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-node-index-seek]]
== Node Index Seek ==
The `NodeIndexSeek` operator finds nodes using an index seek.
The node variable and the index used is shown in the arguments of the operator.
If the index is a unique index, the operator is instead called xref:execution-plans/operators.adoc#query-plan-node-unique-index-seek[NodeUniqueIndexSeek].

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-node-index-seek.query.asciidoc[]
[source,cypher]
----
MATCH (location:Location {name: 'Malmo'}) RETURN location
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-node-index-seek.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+-----------------+----------------------------------------------------+----------------+------+---------+----------------+---------------------+
| Operator        | Details                                            | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Other               |
+-----------------+----------------------------------------------------+----------------+------+---------+----------------+---------------------+
| +ProduceResults | location                                           |              0 |    1 |       0 |                | Fused in Pipeline 0 |
| |               +----------------------------------------------------+----------------+------+---------+----------------+---------------------+
| +NodeIndexSeek  | location:Location(name) WHERE name = $autostring_0 |              0 |    1 |       2 |             72 | Fused in Pipeline 0 |
+-----------------+----------------------------------------------------+----------------+------+---------+----------------+---------------------+

Total database accesses: 2, total allocated memory: 72

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/node-index-seek.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/node-unique-index-seek.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-node-unique-index-seek]]
== Node Unique Index Seek ==
The `NodeUniqueIndexSeek` operator finds nodes using an index seek within a unique index. The node variable and the index used is shown in the arguments of the operator.
If the index is not unique, the operator is instead called xref:execution-plans/operators.adoc#query-plan-node-index-seek[NodeIndexSeek].
If the index seek is used to solve a xref:clauses/merge.adoc[MERGE] clause, it will also be marked with `(Locking)`.
This makes it clear that any nodes returned from the index will be locked in order to prevent concurrent conflicting updates.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-node-unique-index-seek.query.asciidoc[]
[source,cypher]
----
MATCH (t:Team {name: 'Malmo'}) RETURN t
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-node-unique-index-seek.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+----------------------+------------------------------------------------+----------------+------+---------+----------------+---------------------+
| Operator             | Details                                        | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Other               |
+----------------------+------------------------------------------------+----------------+------+---------+----------------+---------------------+
| +ProduceResults      | t                                              |              0 |    0 |       0 |                | Fused in Pipeline 0 |
| |                    +------------------------------------------------+----------------+------+---------+----------------+---------------------+
| +NodeUniqueIndexSeek | UNIQUE t:Team(name) WHERE name = $autostring_0 |              0 |    0 |       1 |             72 | Fused in Pipeline 0 |
+----------------------+------------------------------------------------+----------------+------+---------+----------------+---------------------+

Total database accesses: 1, total allocated memory: 72

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/node-unique-index-seek.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/multi-node-index-seek.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-multi-node-index-seek]]
== Multi Node Index Seek ==
The `MultiNodeIndexSeek` operator finds nodes using multiple index seeks.
It supports using multiple distinct indexes for different nodes in the query.
The node variables and the indexes used are shown in the arguments of the operator.

The operator yields a cartesian product of all index seeks.
For example, if the operator does two seeks and the first seek finds the nodes `a1, a2` and the second `b1, b2, b3`,
the `MultiNodeIndexSeek` will yield the rows `(a1, b1), (a1, b2), (a1, b3), (a2, b1), (a2, b2), (a2, b3)`.


.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-multi-node-index-seek.query.asciidoc[]
[source,cypher]
----
CYPHER runtime=pipelined
MATCH (location:Location {name: 'Malmo'}), (person:Person {name: 'Bob'}) RETURN location, person
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-multi-node-index-seek.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+---------------------+----------------------------------------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------+
| Operator            | Details                                                                                            | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Page Cache Hits/Misses | Time (ms) | Other         |
+---------------------+----------------------------------------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------+
| +ProduceResults     | location, person                                                                                   |              0 |    1 |       0 |                |                    2/0 |     0.121 | In Pipeline 0 |
| |                   +----------------------------------------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------+
| +MultiNodeIndexSeek | location:Location(name) WHERE name = $autostring_0, person:Person(name) WHERE name = $autostring_1 |              0 |    1 |       4 |             72 |                    0/2 |     0.478 | In Pipeline 0 |
+---------------------+----------------------------------------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------+

Total database accesses: 4, total allocated memory: 72

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/multi-node-index-seek.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/node-index-seek-by-range.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-node-index-seek-by-range]]
== Node Index Seek By Range ==
The `NodeIndexSeekByRange` operator finds nodes using an index seek where the value of the property matches a given prefix string.
`NodeIndexSeekByRange` can be used for `STARTS WITH` and comparison operators such as `<`, `>`, `\<=` and `>=`.
If the index is a unique index, the operator is instead called `NodeUniqueIndexSeekByRange`.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-node-index-seek-by-range.query.asciidoc[]
[source,cypher]
----
MATCH (l:Location) WHERE l.name STARTS WITH 'Lon' RETURN l
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-node-index-seek-by-range.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+-----------------------+-------------------------------------------------------+----------------+------+---------+----------------+---------------------+
| Operator              | Details                                               | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Other               |
+-----------------------+-------------------------------------------------------+----------------+------+---------+----------------+---------------------+
| +ProduceResults       | l                                                     |              2 |    1 |       0 |                | Fused in Pipeline 0 |
| |                     +-------------------------------------------------------+----------------+------+---------+----------------+---------------------+
| +NodeIndexSeekByRange | l:Location(name) WHERE name STARTS WITH $autostring_0 |              2 |    1 |       2 |             72 | Fused in Pipeline 0 |
+-----------------------+-------------------------------------------------------+----------------+------+---------+----------------+---------------------+

Total database accesses: 2, total allocated memory: 72

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/node-index-seek-by-range.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/node-unique-index-seek-by-range.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-node-unique-index-seek-by-range]]
== Node Unique Index Seek By Range ==
The `NodeUniqueIndexSeekByRange` operator finds nodes using an index seek within a unique index, where the value of the property matches a given prefix string.
`NodeUniqueIndexSeekByRange` is used by `STARTS WITH` and comparison operators such as `<`, `>`, `\<=` and `>=`.
If the index is not unique, the operator is instead called `NodeIndexSeekByRange`.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-node-unique-index-seek-by-range.query.asciidoc[]
[source,cypher]
----
MATCH (t:Team) WHERE t.name STARTS WITH 'Ma' RETURN t
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-node-unique-index-seek-by-range.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+-----------------------------+----------------------------------------------------------+----------------+------+---------+----------------+---------------------+
| Operator                    | Details                                                  | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Other               |
+-----------------------------+----------------------------------------------------------+----------------+------+---------+----------------+---------------------+
| +ProduceResults             | t                                                        |              2 |    0 |       0 |                | Fused in Pipeline 0 |
| |                           +----------------------------------------------------------+----------------+------+---------+----------------+---------------------+
| +NodeUniqueIndexSeekByRange | UNIQUE t:Team(name) WHERE name STARTS WITH $autostring_0 |              2 |    0 |       1 |             72 | Fused in Pipeline 0 |
+-----------------------------+----------------------------------------------------------+----------------+------+---------+----------------+---------------------+

Total database accesses: 1, total allocated memory: 72

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/node-unique-index-seek-by-range.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/node-index-contains-scan.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-node-index-contains-scan]]
== Node Index Contains Scan ==

The `NodeIndexContainsScan` operator examines all values stored in an index, searching for entries
 containing a specific string; for example, in queries including `CONTAINS`.
 Although this is slower than an index seek (since all entries need to be
 examined), it is still faster than the indirection resulting from a label scan using `NodeByLabelScan`, and a property store
 filter.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-node-index-contains-scan.query.asciidoc[]
[source,cypher]
----
MATCH (l:Location) WHERE l.name CONTAINS 'al' RETURN l
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-node-index-contains-scan.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+------------------------+----------------------------------------------------+----------------+------+---------+----------------+---------------------+
| Operator               | Details                                            | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Other               |
+------------------------+----------------------------------------------------+----------------+------+---------+----------------+---------------------+
| +ProduceResults        | l                                                  |              0 |    2 |       0 |                | Fused in Pipeline 0 |
| |                      +----------------------------------------------------+----------------+------+---------+----------------+---------------------+
| +NodeIndexContainsScan | l:Location(name) WHERE name CONTAINS $autostring_0 |              0 |    2 |       3 |             72 | Fused in Pipeline 0 |
+------------------------+----------------------------------------------------+----------------+------+---------+----------------+---------------------+

Total database accesses: 3, total allocated memory: 72

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/node-index-contains-scan.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/node-index-ends-with-scan.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-node-index-ends-with-scan]]
== Node Index Ends With Scan ==

The `NodeIndexEndsWithScan` operator examines all values stored in an index, searching for entries
 ending in a specific string; for example, in queries containing `ENDS WITH`.
 Although this is slower than an index seek (since all entries need to be
 examined), it is still faster than the indirection resulting from a label scan using `NodeByLabelScan`, and a property store
 filter.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-node-index-ends-with-scan.query.asciidoc[]
[source,cypher]
----
MATCH (l:Location) WHERE l.name ENDS WITH 'al' RETURN l
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-node-index-ends-with-scan.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+------------------------+-----------------------------------------------------+----------------+------+---------+----------------+---------------------+
| Operator               | Details                                             | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Other               |
+------------------------+-----------------------------------------------------+----------------+------+---------+----------------+---------------------+
| +ProduceResults        | l                                                   |              0 |    0 |       0 |                | Fused in Pipeline 0 |
| |                      +-----------------------------------------------------+----------------+------+---------+----------------+---------------------+
| +NodeIndexEndsWithScan | l:Location(name) WHERE name ENDS WITH $autostring_0 |              0 |    0 |       1 |             72 | Fused in Pipeline 0 |
+------------------------+-----------------------------------------------------+----------------+------+---------+----------------+---------------------+

Total database accesses: 1, total allocated memory: 72

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/node-index-ends-with-scan.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/node-index-scan.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-node-index-scan]]
== Node Index Scan ==

The `NodeIndexScan` operator examines all values stored in an index, returning all nodes with a particular label having a specified property.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-node-index-scan.query.asciidoc[]
[source,cypher]
----
MATCH (l:Location) WHERE exists(l.name) RETURN l
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-node-index-scan.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+-----------------+-------------------------------------+----------------+------+---------+----------------+---------------------+
| Operator        | Details                             | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Other               |
+-----------------+-------------------------------------+----------------+------+---------+----------------+---------------------+
| +ProduceResults | l                                   |             10 |   10 |       0 |                | Fused in Pipeline 0 |
| |               +-------------------------------------+----------------+------+---------+----------------+---------------------+
| +NodeIndexScan  | l:Location(name) WHERE exists(name) |             10 |   10 |      11 |             72 | Fused in Pipeline 0 |
+-----------------+-------------------------------------+----------------+------+---------+----------------+---------------------+

Total database accesses: 11, total allocated memory: 72

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/node-index-scan.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/undirected-relationship-by-id-seek.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-undirected-relationship-by-id-seek]]
== Undirected Relationship By Id Seek ==
The `UndirectedRelationshipByIdSeek` operator reads one or more relationships by id from the relationship store.
As the direction is unspecified, two rows are produced for each relationship as a result of alternating the combination of the start and end node.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-undirected-relationship-by-id-seek.query.asciidoc[]
[source,cypher]
----
MATCH (n1)-[r]-()
           WHERE id(r) = 1
           RETURN r, n1
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-undirected-relationship-by-id-seek.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+---------------------------------+---------------------------------------------+----------------+------+---------+----------------+---------------------+
| Operator                        | Details                                     | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Other               |
+---------------------------------+---------------------------------------------+----------------+------+---------+----------------+---------------------+
| +ProduceResults                 | r, n1                                       |              1 |    2 |       0 |                | Fused in Pipeline 0 |
| |                               +---------------------------------------------+----------------+------+---------+----------------+---------------------+
| +UndirectedRelationshipByIdSeek | (n1)-[r]-(anon_16) WHERE id(r) = $autoint_0 |              1 |    2 |       1 |             72 | Fused in Pipeline 0 |
+---------------------------------+---------------------------------------------+----------------+------+---------+----------------+---------------------+

Total database accesses: 1, total allocated memory: 72

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/undirected-relationship-by-id-seek.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/apply.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-apply]]
== Apply ==

All the different `Apply` operators (listed below) share the same basic functionality: they perform a nested loop by taking a single row from the left-hand side, and using the xref:execution-plans/operators.adoc#query-plan-argument[Argument] operator on the right-hand side, execute the operator tree on the right-hand side.
The versions of the `Apply` operators differ in how the results are managed.
The `Apply` operator (i.e. the standard version) takes the row produced by the right-hand side -- which at this point contains data from both the left-hand and right-hand sides -- and yields it..

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-apply.query.asciidoc[]
[source,cypher]
----
MATCH (p:Person {name:'me'})
MATCH (q:Person {name: p.secondName})
RETURN p, q
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-apply.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+------------------+-------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| Operator         | Details                                   | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Page Cache Hits/Misses | Time (ms) | Other               |
+------------------+-------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +ProduceResults  | p, q                                      |              1 |    0 |       0 |                |                        |           | Fused in Pipeline 1 |
| |                +-------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +Apply           |                                           |              1 |    0 |       0 |                |                    0/0 |           |                     |
| |\               +-------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| | +NodeIndexSeek | q:Person(name) WHERE name = p.secondName  |              1 |    0 |       0 |             80 |                        |           | Fused in Pipeline 1 |
| |                +-------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +NodeIndexSeek   | p:Person(name) WHERE name = $autostring_0 |              1 |    1 |       2 |             72 |                    0/1 |     0.287 | In Pipeline 0       |
+------------------+-------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+

Total database accesses: 2, total allocated memory: 80

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/apply.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/semi-apply.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-semi-apply]]
== Semi Apply ==
The `SemiApply` operator tests for the presence of a pattern predicate, and is a variation of the xref:execution-plans/operators.adoc#query-plan-apply[Apply] operator.
If the right-hand side operator yields at least one row, the row from the left-hand side operator is yielded by the `SemiApply` operator.
This makes `SemiApply` a filtering operator, used mostly for pattern predicates in queries.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-semi-apply.query.asciidoc[]
[source,cypher]
----
CYPHER runtime=slotted
MATCH (p:Person)
WHERE (p)-[:FRIENDS_WITH]->(:Person)
RETURN p.name
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-semi-apply.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime SLOTTED

Runtime version 4.2

+------------------+---------------------------------------+----------------+------+---------+------------------------+
| Operator         | Details                               | Estimated Rows | Rows | DB Hits | Page Cache Hits/Misses |
+------------------+---------------------------------------+----------------+------+---------+------------------------+
| +ProduceResults  | `p.name`                              |             11 |    2 |       0 |                    0/0 |
| |                +---------------------------------------+----------------+------+---------+------------------------+
| +Projection      | p.name AS `p.name`                    |             11 |    2 |       2 |                    1/0 |
| |                +---------------------------------------+----------------+------+---------+------------------------+
| +SemiApply       |                                       |             11 |    2 |       0 |                    0/0 |
| |\               +---------------------------------------+----------------+------+---------+------------------------+
| | +Filter        | anon_45:Person                        |              2 |    0 |       2 |                    1/0 |
| | |              +---------------------------------------+----------------+------+---------+------------------------+
| | +Expand(All)   | (p)-[anon_27:FRIENDS_WITH]->(anon_45) |              2 |    2 |      33 |                   15/0 |
| | |              +---------------------------------------+----------------+------+---------+------------------------+
| | +Argument      | p                                     |             14 |   14 |       0 |                    0/0 |
| |                +---------------------------------------+----------------+------+---------+------------------------+
| +NodeByLabelScan | p:Person                              |             14 |   14 |      15 |                    2/0 |
+------------------+---------------------------------------+----------------+------+---------+------------------------+

Total database accesses: 52, total allocated memory: 0

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/semi-apply.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/anti-semi-apply.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-anti-semi-apply]]
== Anti Semi Apply ==
The `AntiSemiApply` operator tests for the absence of a pattern, and is a variation of the xref:execution-plans/operators.adoc#query-plan-apply[Apply] operator.
If the right-hand side operator yields no rows, the row from the left-hand side operator is yielded by the `AntiSemiApply` operator.
This makes `AntiSemiApply` a filtering operator, used for pattern predicates in queries.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-anti-semi-apply.query.asciidoc[]
[source,cypher]
----
CYPHER runtime=slotted
MATCH (me:Person {name: "me"}), (other:Person)
WHERE NOT (me)-[:FRIENDS_WITH]->(other)
RETURN other.name
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-anti-semi-apply.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime SLOTTED

Runtime version 4.2

+--------------------+--------------------------------------------+----------------+------+---------+----------------+------------------------+
| Operator           | Details                                    | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Page Cache Hits/Misses |
+--------------------+--------------------------------------------+----------------+------+---------+----------------+------------------------+
| +ProduceResults    | `other.name`                               |              4 |   13 |       0 |                |                    0/0 |
| |                  +--------------------------------------------+----------------+------+---------+----------------+------------------------+
| +Projection        | other.name AS `other.name`                 |              4 |   13 |      13 |                |                    2/0 |
| |                  +--------------------------------------------+----------------+------+---------+----------------+------------------------+
| +AntiSemiApply     |                                            |              4 |   13 |       0 |                |                    0/0 |
| |\                 +--------------------------------------------+----------------+------+---------+----------------+------------------------+
| | +Expand(Into)    | (me)-[anon_62:FRIENDS_WITH]->(other)       |              0 |    0 |      55 |            896 |                   15/0 |
| | |                +--------------------------------------------+----------------+------+---------+----------------+------------------------+
| | +Argument        | me, other                                  |             14 |   14 |       0 |                |                    0/0 |
| |                  +--------------------------------------------+----------------+------+---------+----------------+------------------------+
| +CartesianProduct  |                                            |             14 |   14 |       0 |                |                    0/0 |
| |\                 +--------------------------------------------+----------------+------+---------+----------------+------------------------+
| | +NodeByLabelScan | other:Person                               |             14 |   14 |      15 |                |                    2/0 |
| |                  +--------------------------------------------+----------------+------+---------+----------------+------------------------+
| +NodeIndexSeek     | me:Person(name) WHERE name = $autostring_0 |              1 |    1 |       2 |                |                    0/1 |
+--------------------+--------------------------------------------+----------------+------+---------+----------------+------------------------+

Total database accesses: 85, total allocated memory: 896

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/anti-semi-apply.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/anti.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-anti]]
== Anti ==
The `Anti` operator tests for the absence of a pattern.
If there are incoming rows, the `Anti` operator will yield no rows.
If there are no incoming rows, the `Anti` operator will yield a single row.


.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-anti.query.asciidoc[]
[source,cypher]
----
CYPHER runtime=pipelined
MATCH (me:Person {name: "me"}), (other:Person)
WHERE NOT (me)-[:FRIENDS_WITH]->(other)
RETURN other.name
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-anti.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+--------------------+--------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| Operator           | Details                                    | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Page Cache Hits/Misses | Time (ms) | Other               |
+--------------------+--------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +ProduceResults    | `other.name`                               |              4 |   13 |       0 |                |                    0/0 |     0.107 | In Pipeline 4       |
| |                  +--------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +Projection        | other.name AS `other.name`                 |              4 |   13 |      26 |                |                    2/0 |     0.059 | In Pipeline 4       |
| |                  +--------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +Apply             |                                            |              4 |   13 |       0 |                |                    0/0 |           |                     |
| |\                 +--------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| | +Anti            |                                            |             14 |   13 |       0 |                |                    0/0 |     0.066 | In Pipeline 4       |
| | |                +--------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| | +Limit           | 1                                          |             14 |    1 |       0 |                |                        |           | Fused in Pipeline 3 |
| | |                +--------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| | +Expand(Into)    | (me)-[anon_62:FRIENDS_WITH]->(other)       |              0 |    1 |      55 |           2856 |                        |           | Fused in Pipeline 3 |
| | |                +--------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| | +Argument        | me, other                                  |             14 |   14 |       0 |            408 |                        |           | Fused in Pipeline 3 |
| |                  +--------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +CartesianProduct  |                                            |             14 |   14 |       0 |            296 |                    0/0 |     0.112 | In Pipeline 2       |
| |\                 +--------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| | +NodeByLabelScan | other:Person                               |             14 |   14 |      15 |             88 |                    2/0 |     0.087 | In Pipeline 1       |
| |                  +--------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +NodeIndexSeek     | me:Person(name) WHERE name = $autostring_0 |              1 |    1 |       2 |             72 |                    0/1 |     0.255 | In Pipeline 0       |
+--------------------+--------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+

Total database accesses: 98, total allocated memory: 2856

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/anti.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/let-semi-apply.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-let-semi-apply]]
== Let Semi Apply ==
The `LetSemiApply` operator tests for the presence of a pattern predicate, and is a variation of the xref:execution-plans/operators.adoc#query-plan-apply[Apply] operator.
When a query contains multiple pattern predicates separated with `OR`, `LetSemiApply` will be used to evaluate the first of these.
It will record the result of evaluating the predicate but will leave any filtering to another operator.
In the example, `LetSemiApply` will be used to check for the presence of the `FRIENDS_WITH`
relationship from each person.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-let-semi-apply.query.asciidoc[]
[source,cypher]
----
CYPHER runtime=slotted
MATCH (other:Person)
WHERE (other)-[:FRIENDS_WITH]->(:Person) OR (other)-[:WORKS_IN]->(:Location)
RETURN other.name
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-let-semi-apply.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime SLOTTED

Runtime version 4.2

+--------------------+-------------------------------------------+----------------+------+---------+------------------------+
| Operator           | Details                                   | Estimated Rows | Rows | DB Hits | Page Cache Hits/Misses |
+--------------------+-------------------------------------------+----------------+------+---------+------------------------+
| +ProduceResults    | `other.name`                              |             13 |   14 |       0 |                    0/0 |
| |                  +-------------------------------------------+----------------+------+---------+------------------------+
| +Projection        | other.name AS `other.name`                |             13 |   14 |      14 |                    1/0 |
| |                  +-------------------------------------------+----------------+------+---------+------------------------+
| +SelectOrSemiApply | anon_27                                   |             14 |   14 |       0 |                    0/0 |
| |\                 +-------------------------------------------+----------------+------+---------+------------------------+
| | +Filter          | anon_87:Location                          |             15 |    0 |      12 |                    0/0 |
| | |                +-------------------------------------------+----------------+------+---------+------------------------+
| | +Expand(All)     | (other)-[anon_73:WORKS_IN]->(anon_87)     |             15 |   12 |      26 |                   12/0 |
| | |                +-------------------------------------------+----------------+------+---------+------------------------+
| | +Argument        | other                                     |             14 |   12 |       0 |                    0/0 |
| |                  +-------------------------------------------+----------------+------+---------+------------------------+
| +LetSemiApply      |                                           |             14 |   14 |       0 |                    0/0 |
| |\                 +-------------------------------------------+----------------+------+---------+------------------------+
| | +Filter          | anon_53:Person                            |              2 |    0 |       2 |                    1/0 |
| | |                +-------------------------------------------+----------------+------+---------+------------------------+
| | +Expand(All)     | (other)-[anon_35:FRIENDS_WITH]->(anon_53) |              2 |    2 |      33 |                   15/0 |
| | |                +-------------------------------------------+----------------+------+---------+------------------------+
| | +Argument        | other                                     |             14 |   14 |       0 |                    0/0 |
| |                  +-------------------------------------------+----------------+------+---------+------------------------+
| +NodeByLabelScan   | other:Person                              |             14 |   14 |      15 |                    2/0 |
+--------------------+-------------------------------------------+----------------+------+---------+------------------------+

Total database accesses: 102, total allocated memory: 0

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/let-semi-apply.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/let-anti-semi-apply.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-let-anti-semi-apply]]
== Let Anti Semi Apply ==
The `LetAntiSemiApply` operator tests for the absence of a pattern, and is a variation of the xref:execution-plans/operators.adoc#query-plan-apply[Apply] operator.
When a query contains multiple negated pattern predicates -- i.e. predicates separated with `OR`, where at
least one predicate contains `NOT` -- `LetAntiSemiApply` will be used to evaluate the first of these.
It will record the result of evaluating the predicate but will leave any filtering to another operator.
In the example, `LetAntiSemiApply` will be used to check for the absence of
the `FRIENDS_WITH` relationship from each person.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-let-anti-semi-apply.query.asciidoc[]
[source,cypher]
----
CYPHER runtime=slotted
MATCH (other:Person)
WHERE NOT ((other)-[:FRIENDS_WITH]->(:Person)) OR (other)-[:WORKS_IN]->(:Location)
RETURN other.name
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-let-anti-semi-apply.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime SLOTTED

Runtime version 4.2

+--------------------+-------------------------------------------+----------------+------+---------+------------------------+
| Operator           | Details                                   | Estimated Rows | Rows | DB Hits | Page Cache Hits/Misses |
+--------------------+-------------------------------------------+----------------+------+---------+------------------------+
| +ProduceResults    | `other.name`                              |             11 |   14 |       0 |                    0/0 |
| |                  +-------------------------------------------+----------------+------+---------+------------------------+
| +Projection        | other.name AS `other.name`                |             11 |   14 |      14 |                    1/0 |
| |                  +-------------------------------------------+----------------+------+---------+------------------------+
| +SelectOrSemiApply | anon_32                                   |             14 |   14 |       0 |                    0/0 |
| |\                 +-------------------------------------------+----------------+------+---------+------------------------+
| | +Filter          | anon_93:Location                          |             15 |    0 |       2 |                    0/0 |
| | |                +-------------------------------------------+----------------+------+---------+------------------------+
| | +Expand(All)     | (other)-[anon_79:WORKS_IN]->(anon_93)     |             15 |    2 |       7 |                    2/0 |
| | |                +-------------------------------------------+----------------+------+---------+------------------------+
| | +Argument        | other                                     |             14 |    2 |       0 |                    0/0 |
| |                  +-------------------------------------------+----------------+------+---------+------------------------+
| +LetAntiSemiApply  |                                           |             14 |   14 |       0 |                    0/0 |
| |\                 +-------------------------------------------+----------------+------+---------+------------------------+
| | +Filter          | anon_58:Person                            |              2 |    0 |       2 |                    1/0 |
| | |                +-------------------------------------------+----------------+------+---------+------------------------+
| | +Expand(All)     | (other)-[anon_40:FRIENDS_WITH]->(anon_58) |              2 |    2 |      33 |                   15/0 |
| | |                +-------------------------------------------+----------------+------+---------+------------------------+
| | +Argument        | other                                     |             14 |   14 |       0 |                    0/0 |
| |                  +-------------------------------------------+----------------+------+---------+------------------------+
| +NodeByLabelScan   | other:Person                              |             14 |   14 |      15 |                    2/0 |
+--------------------+-------------------------------------------+----------------+------+---------+------------------------+

Total database accesses: 73, total allocated memory: 0

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/let-anti-semi-apply.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/select-or-semi-apply.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-select-or-semi-apply]]
== Select Or Semi Apply ==
The `SelectOrSemiApply` operator tests for the presence of a pattern predicate and evaluates a predicate,
and is a variation of the xref:execution-plans/operators.adoc#query-plan-apply[Apply] operator.
This operator allows for the mixing of normal predicates and pattern predicates
that check for the presence of a pattern.
First, the normal expression predicate is evaluated, and, only if it returns `false`, is the costly pattern predicate evaluated.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-select-or-semi-apply.query.asciidoc[]
[source,cypher]
----
MATCH (other:Person)
WHERE other.age > 25 OR (other)-[:FRIENDS_WITH]->(:Person)
RETURN other.name
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-select-or-semi-apply.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+--------------------+-------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| Operator           | Details                                   | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Page Cache Hits/Misses | Time (ms) | Other               |
+--------------------+-------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +ProduceResults    | `other.name`                              |             11 |    2 |       0 |                |                        |           | Fused in Pipeline 2 |
| |                  +-------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +Projection        | other.name AS `other.name`                |             11 |    2 |       4 |                |                        |           | Fused in Pipeline 2 |
| |                  +-------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +SelectOrSemiApply | other.age > $autoint_0                    |             14 |    2 |       0 |            128 |                        |           | Fused in Pipeline 2 |
| |\                 +-------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| | +Limit           | 1                                         |             14 |    2 |       0 |                |                        |           | Fused in Pipeline 1 |
| | |                +-------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| | +Filter          | anon_71:Person                            |              2 |    2 |       2 |                |                        |           | Fused in Pipeline 1 |
| | |                +-------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| | +Expand(All)     | (other)-[anon_53:FRIENDS_WITH]->(anon_71) |              2 |    2 |      32 |                |                        |           | Fused in Pipeline 1 |
| | |                +-------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| | +Argument        | other                                     |             14 |   14 |       0 |            296 |                        |           | Fused in Pipeline 1 |
| |                  +-------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +NodeByLabelScan   | other:Person                              |             14 |   14 |      15 |             72 |                    2/0 |     0.090 | In Pipeline 0       |
+--------------------+-------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+

Total database accesses: 53, total allocated memory: 296

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/select-or-semi-apply.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/select-or-anti-semi-apply.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-select-or-anti-semi-apply]]
== Select Or Anti Semi Apply ==
The `SelectOrAntiSemiApply` operator is used to evaluate `OR` between a predicate and a negative pattern predicate
(i.e. a pattern predicate preceded with `NOT`), and is a variation of the xref:execution-plans/operators.adoc#query-plan-apply[Apply] operator.
If the predicate returns `true`, the pattern predicate is not tested.
If the predicate returns `false` or `null`, `SelectOrAntiSemiApply` will instead test the pattern predicate.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-select-or-anti-semi-apply.query.asciidoc[]
[source,cypher]
----
MATCH (other:Person)
WHERE other.age > 25 OR NOT (other)-[:FRIENDS_WITH]->(:Person)
RETURN other.name
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-select-or-anti-semi-apply.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+------------------------+-------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| Operator               | Details                                   | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Page Cache Hits/Misses | Time (ms) | Other               |
+------------------------+-------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +ProduceResults        | `other.name`                              |              4 |   12 |       0 |                |                        |           | Fused in Pipeline 3 |
| |                      +-------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +Projection            | other.name AS `other.name`                |              4 |   12 |      24 |                |                        |           | Fused in Pipeline 3 |
| |                      +-------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +SelectOrAntiSemiApply | other.age > $autoint_0                    |             14 |   12 |       0 |            448 |                        |           | Fused in Pipeline 3 |
| |\                     +-------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| | +Anti                |                                           |             14 |   12 |       0 |              0 |                    0/0 |     0.088 | In Pipeline 2       |
| | |                    +-------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| | +Limit               | 1                                         |             14 |    2 |       0 |                |                        |           | Fused in Pipeline 1 |
| | |                    +-------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| | +Filter              | anon_75:Person                            |              2 |    2 |       2 |                |                        |           | Fused in Pipeline 1 |
| | |                    +-------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| | +Expand(All)         | (other)-[anon_57:FRIENDS_WITH]->(anon_75) |              2 |    2 |      32 |                |                        |           | Fused in Pipeline 1 |
| | |                    +-------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| | +Argument            | other                                     |             14 |   14 |       0 |            296 |                        |           | Fused in Pipeline 1 |
| |                      +-------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +NodeByLabelScan       | other:Person                              |             14 |   14 |      15 |             72 |                    2/0 |     0.193 | In Pipeline 0       |
+------------------------+-------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+

Total database accesses: 73, total allocated memory: 448

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/select-or-anti-semi-apply.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/let-select-or-semi-apply.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-let-select-or-semi-apply]]
== Let Select Or Semi Apply ==
The `LetSelectOrSemiApply` operator is planned for pattern predicates that are combined with other predicates using `OR`.
This is a variation of the xref:execution-plans/operators.adoc#query-plan-apply[Apply] operator.
        

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-let-select-or-semi-apply.query.asciidoc[]
[source,cypher]
----
CYPHER runtime=slotted
MATCH (other:Person)
WHERE (other)-[:FRIENDS_WITH]->(:Person) OR (other)-[:WORKS_IN]->(:Location) OR other.age = 5
RETURN other.name
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-let-select-or-semi-apply.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime SLOTTED

Runtime version 4.2

+-----------------------+-------------------------------------------+----------------+------+---------+------------------------+
| Operator              | Details                                   | Estimated Rows | Rows | DB Hits | Page Cache Hits/Misses |
+-----------------------+-------------------------------------------+----------------+------+---------+------------------------+
| +ProduceResults       | `other.name`                              |             13 |   14 |       0 |                    0/0 |
| |                     +-------------------------------------------+----------------+------+---------+------------------------+
| +Projection           | other.name AS `other.name`                |             13 |   14 |      14 |                    1/0 |
| |                     +-------------------------------------------+----------------+------+---------+------------------------+
| +SelectOrSemiApply    | anon_27                                   |             14 |   14 |       0 |                    0/0 |
| |\                    +-------------------------------------------+----------------+------+---------+------------------------+
| | +Filter             | anon_87:Location                          |             15 |    0 |      12 |                    0/0 |
| | |                   +-------------------------------------------+----------------+------+---------+------------------------+
| | +Expand(All)        | (other)-[anon_73:WORKS_IN]->(anon_87)     |             15 |   12 |      26 |                   12/0 |
| | |                   +-------------------------------------------+----------------+------+---------+------------------------+
| | +Argument           | other                                     |             14 |   12 |       0 |                    0/0 |
| |                     +-------------------------------------------+----------------+------+---------+------------------------+
| +LetSelectOrSemiApply | other.age = $autoint_0                    |             14 |   14 |      14 |                    0/0 |
| |\                    +-------------------------------------------+----------------+------+---------+------------------------+
| | +Filter             | anon_53:Person                            |              2 |    0 |       2 |                    1/0 |
| | |                   +-------------------------------------------+----------------+------+---------+------------------------+
| | +Expand(All)        | (other)-[anon_35:FRIENDS_WITH]->(anon_53) |              2 |    2 |      33 |                   15/0 |
| | |                   +-------------------------------------------+----------------+------+---------+------------------------+
| | +Argument           | other                                     |             14 |   14 |       0 |                    0/0 |
| |                     +-------------------------------------------+----------------+------+---------+------------------------+
| +NodeByLabelScan      | other:Person                              |             14 |   14 |      15 |                    2/0 |
+-----------------------+-------------------------------------------+----------------+------+---------+------------------------+

Total database accesses: 116, total allocated memory: 0

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/let-select-or-semi-apply.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/let-select-or-anti-semi-apply.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-let-select-or-anti-semi-apply]]
== Let Select Or Anti Semi Apply ==
The `LetSelectOrAntiSemiApply` operator is planned for negated pattern predicates -- i.e. pattern predicates
preceded with `NOT` -- that are combined with other predicates using `OR`.
This operator is a variation of the xref:execution-plans/operators.adoc#query-plan-apply[Apply] operator.
        

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-let-select-or-anti-semi-apply.query.asciidoc[]
[source,cypher]
----
CYPHER runtime=slotted
MATCH (other:Person)
WHERE NOT (other)-[:FRIENDS_WITH]->(:Person) OR (other)-[:WORKS_IN]->(:Location) OR other.age = 5
RETURN other.name
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-let-select-or-anti-semi-apply.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime SLOTTED

Runtime version 4.2

+---------------------------+-------------------------------------------+----------------+------+---------+------------------------+
| Operator                  | Details                                   | Estimated Rows | Rows | DB Hits | Page Cache Hits/Misses |
+---------------------------+-------------------------------------------+----------------+------+---------+------------------------+
| +ProduceResults           | `other.name`                              |             11 |   14 |       0 |                    0/0 |
| |                         +-------------------------------------------+----------------+------+---------+------------------------+
| +Projection               | other.name AS `other.name`                |             11 |   14 |      14 |                    1/0 |
| |                         +-------------------------------------------+----------------+------+---------+------------------------+
| +SelectOrSemiApply        | anon_31                                   |             14 |   14 |       0 |                    0/0 |
| |\                        +-------------------------------------------+----------------+------+---------+------------------------+
| | +Filter                 | anon_91:Location                          |             15 |    0 |       2 |                    0/0 |
| | |                       +-------------------------------------------+----------------+------+---------+------------------------+
| | +Expand(All)            | (other)-[anon_77:WORKS_IN]->(anon_91)     |             15 |    2 |       7 |                    2/0 |
| | |                       +-------------------------------------------+----------------+------+---------+------------------------+
| | +Argument               | other                                     |             14 |    2 |       0 |                    0/0 |
| |                         +-------------------------------------------+----------------+------+---------+------------------------+
| +LetSelectOrAntiSemiApply | other.age = $autoint_0                    |             14 |   14 |      14 |                    0/0 |
| |\                        +-------------------------------------------+----------------+------+---------+------------------------+
| | +Filter                 | anon_57:Person                            |              2 |    0 |       2 |                    1/0 |
| | |                       +-------------------------------------------+----------------+------+---------+------------------------+
| | +Expand(All)            | (other)-[anon_39:FRIENDS_WITH]->(anon_57) |              2 |    2 |      33 |                   15/0 |
| | |                       +-------------------------------------------+----------------+------+---------+------------------------+
| | +Argument               | other                                     |             14 |   14 |       0 |                    0/0 |
| |                         +-------------------------------------------+----------------+------+---------+------------------------+
| +NodeByLabelScan          | other:Person                              |             14 |   14 |      15 |                    2/0 |
+---------------------------+-------------------------------------------+----------------+------+---------+------------------------+

Total database accesses: 87, total allocated memory: 0

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/let-select-or-anti-semi-apply.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/conditional-apply.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-conditional-apply]]
== Conditional Apply ==
The `ConditionalApply` operator checks whether a variable is not `null`, and if so, the right child operator will be executed.
This operator is a variation of the xref:execution-plans/operators.adoc#query-plan-apply[Apply] operator.
        

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-conditional-apply.query.asciidoc[]
[source,cypher]
----
MERGE (p:Person {name: 'Andy'})
ON MATCH SET p.exists = true
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-conditional-apply.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime SLOTTED

Runtime version 4.2

+-----------------------+-------------------------------------------+----------------+------+---------+------------------------+
| Operator              | Details                                   | Estimated Rows | Rows | DB Hits | Page Cache Hits/Misses |
+-----------------------+-------------------------------------------+----------------+------+---------+------------------------+
| +ProduceResults       |                                           |              1 |    0 |       0 |                    0/0 |
| |                     +-------------------------------------------+----------------+------+---------+------------------------+
| +EmptyResult          |                                           |              1 |    0 |       0 |                    0/0 |
| |                     +-------------------------------------------+----------------+------+---------+------------------------+
| +AntiConditionalApply |                                           |              1 |    1 |       0 |                    0/0 |
| |\                    +-------------------------------------------+----------------+------+---------+------------------------+
| | +MergeCreateNode    | p                                         |              1 |    0 |       0 |                    0/0 |
| |                     +-------------------------------------------+----------------+------+---------+------------------------+
| +ConditionalApply     |                                           |              1 |    1 |       0 |                    0/0 |
| |\                    +-------------------------------------------+----------------+------+---------+------------------------+
| | +SetProperty        | p.exists = true                           |              1 |    1 |       3 |                    2/0 |
| | |                   +-------------------------------------------+----------------+------+---------+------------------------+
| | +Argument           | p                                         |              1 |    1 |       0 |                    0/0 |
| |                     +-------------------------------------------+----------------+------+---------+------------------------+
| +Optional             |                                           |              1 |    1 |       0 |                    0/0 |
| |                     +-------------------------------------------+----------------+------+---------+------------------------+
| +NodeIndexSeek        | p:Person(name) WHERE name = $autostring_0 |              1 |    1 |       2 |                    0/1 |
+-----------------------+-------------------------------------------+----------------+------+---------+------------------------+

Total database accesses: 5, total allocated memory: 0

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/conditional-apply.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/anti-conditional-apply.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-anti-conditional-apply]]
== Anti Conditional Apply ==
The `AntiConditionalApply` operator checks whether a variable is `null`, and if so, the right child operator will be executed.
This operator is a variation of the xref:execution-plans/operators.adoc#query-plan-apply[Apply] operator.
        

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-anti-conditional-apply.query.asciidoc[]
[source,cypher]
----
MERGE (p:Person {name: 'Andy'})
ON CREATE SET p.exists = true
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-anti-conditional-apply.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime SLOTTED

Runtime version 4.2

+-----------------------+-------------------------------------------+----------------+------+---------+------------------------+
| Operator              | Details                                   | Estimated Rows | Rows | DB Hits | Page Cache Hits/Misses |
+-----------------------+-------------------------------------------+----------------+------+---------+------------------------+
| +ProduceResults       |                                           |              1 |    0 |       0 |                    0/0 |
| |                     +-------------------------------------------+----------------+------+---------+------------------------+
| +EmptyResult          |                                           |              1 |    0 |       0 |                    0/0 |
| |                     +-------------------------------------------+----------------+------+---------+------------------------+
| +AntiConditionalApply |                                           |              1 |    1 |       0 |                    0/0 |
| |\                    +-------------------------------------------+----------------+------+---------+------------------------+
| | +SetProperty        | p.exists = true                           |              1 |    0 |       0 |                    0/0 |
| | |                   +-------------------------------------------+----------------+------+---------+------------------------+
| | +MergeCreateNode    | p                                         |              1 |    0 |       0 |                    0/0 |
| |                     +-------------------------------------------+----------------+------+---------+------------------------+
| +Optional             |                                           |              1 |    1 |       0 |                    0/0 |
| |                     +-------------------------------------------+----------------+------+---------+------------------------+
| +NodeIndexSeek        | p:Person(name) WHERE name = $autostring_0 |              1 |    1 |       2 |                    0/1 |
+-----------------------+-------------------------------------------+----------------+------+---------+------------------------+

Total database accesses: 2, total allocated memory: 0

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/anti-conditional-apply.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/roll-up-apply.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-roll-up-apply]]
== Roll Up Apply ==
The `RollUpApply` operator is used to execute an expression which takes as input a pattern, and returns a list with content from the matched pattern;
for example, when using a pattern expression or pattern comprehension in a query.
This operator is a variation of the xref:execution-plans/operators.adoc#query-plan-apply[Apply] operator.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-roll-up-apply.query.asciidoc[]
[source,cypher]
----
CYPHER runtime=slotted
MATCH (p:Person)
RETURN p.name, [ (p)-[:WORKS_IN]->(location) | location.name ] AS cities
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-roll-up-apply.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime SLOTTED

Runtime version 4.2

+------------------+------------------------------------+----------------+------+---------+------------------------+
| Operator         | Details                            | Estimated Rows | Rows | DB Hits | Page Cache Hits/Misses |
+------------------+------------------------------------+----------------+------+---------+------------------------+
| +ProduceResults  | `p.name`, cities                   |             14 |   14 |       0 |                    0/0 |
| |                +------------------------------------+----------------+------+---------+------------------------+
| +Projection      | p.name AS `p.name`                 |             14 |   14 |      14 |                    0/0 |
| |                +------------------------------------+----------------+------+---------+------------------------+
| +RollUpApply     | cities, anon_32                    |             14 |   14 |       0 |                    0/0 |
| |\               +------------------------------------+----------------+------+---------+------------------------+
| | +Projection    | location.name AS anon_32           |              0 |   15 |      15 |                    2/0 |
| | |              +------------------------------------+----------------+------+---------+------------------------+
| | +Expand(All)   | (p)-[anon_38:WORKS_IN]->(location) |              0 |   15 |      33 |                   15/0 |
| | |              +------------------------------------+----------------+------+---------+------------------------+
| | +Argument      | p                                  |              1 |   14 |       0 |                    0/0 |
| |                +------------------------------------+----------------+------+---------+------------------------+
| +NodeByLabelScan | p:Person                           |             14 |   14 |      15 |                    2/0 |
+------------------+------------------------------------+----------------+------+---------+------------------------+

Total database accesses: 77, total allocated memory: 0

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/roll-up-apply.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/argument.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-argument]]
== Argument ==
The `Argument` operator indicates the variable to be used as an argument to the right-hand side of an xref:execution-plans/operators.adoc#query-plan-apply[Apply] operator.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-argument.query.asciidoc[]
[source,cypher]
----
MATCH (s:Person {name: 'me'}) MERGE (s)-[:FRIENDS_WITH]->(s)
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-argument.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime SLOTTED

Runtime version 4.2

+------------------------------+-------------------------------------------+----------------+------+---------+----------------+------------------------+
| Operator                     | Details                                   | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Page Cache Hits/Misses |
+------------------------------+-------------------------------------------+----------------+------+---------+----------------+------------------------+
| +ProduceResults              |                                           |              1 |    0 |       0 |                |                    0/0 |
| |                            +-------------------------------------------+----------------+------+---------+----------------+------------------------+
| +EmptyResult                 |                                           |              1 |    0 |       0 |                |                    0/0 |
| |                            +-------------------------------------------+----------------+------+---------+----------------+------------------------+
| +Apply                       |                                           |              1 |    1 |       0 |                |                    0/0 |
| |\                           +-------------------------------------------+----------------+------+---------+----------------+------------------------+
| | +AntiConditionalApply      |                                           |              1 |    1 |       0 |                |                    0/0 |
| | |\                         +-------------------------------------------+----------------+------+---------+----------------+------------------------+
| | | +MergeCreateRelationship | (s)-[anon_40:FRIENDS_WITH]->(s)           |              1 |    1 |       2 |                |                    2/0 |
| | | |                        +-------------------------------------------+----------------+------+---------+----------------+------------------------+
| | | +Argument                | s                                         |              1 |    1 |       0 |                |                    0/0 |
| | |                          +-------------------------------------------+----------------+------+---------+----------------+------------------------+
| | +AntiConditionalApply      |                                           |              1 |    1 |       0 |                |                    0/0 |
| | |\                         +-------------------------------------------+----------------+------+---------+----------------+------------------------+
| | | +Optional                | s                                         |              1 |    1 |       0 |                |                    0/0 |
| | | |                        +-------------------------------------------+----------------+------+---------+----------------+------------------------+
| | | +Expand(Into)            | (s)-[anon_40:FRIENDS_WITH]->(s)           |              0 |    0 |       4 |            896 |                    1/0 |
| | | |                        +-------------------------------------------+----------------+------+---------+----------------+------------------------+
| | | +LockNodes               | s                                         |              1 |    1 |       0 |                |                    0/0 |
| | | |                        +-------------------------------------------+----------------+------+---------+----------------+------------------------+
| | | +Argument                | s                                         |              1 |    1 |       0 |                |                    0/0 |
| | |                          +-------------------------------------------+----------------+------+---------+----------------+------------------------+
| | +Optional                  | s                                         |              1 |    1 |       0 |                |                    0/0 |
| | |                          +-------------------------------------------+----------------+------+---------+----------------+------------------------+
| | +Expand(Into)              | (s)-[anon_40:FRIENDS_WITH]->(s)           |              0 |    0 |       4 |            896 |                    2/0 |
| | |                          +-------------------------------------------+----------------+------+---------+----------------+------------------------+
| | +Argument                  | s                                         |              1 |    1 |       0 |                |                    0/0 |
| |                            +-------------------------------------------+----------------+------+---------+----------------+------------------------+
| +NodeIndexSeek               | s:Person(name) WHERE name = $autostring_0 |              1 |    1 |       2 |                |                    0/1 |
+------------------------------+-------------------------------------------+----------------+------+---------+----------------+------------------------+

Total database accesses: 12, total allocated memory: 896

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/argument.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/expand-all.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-expand-all]]
== Expand All ==
Given a start node, and depending on the pattern relationship, the `Expand(All)` operator will traverse incoming or outgoing relationships.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-expand-all.query.asciidoc[]
[source,cypher]
----
MATCH (p:Person {name: 'me'})-[:FRIENDS_WITH]->(fof) RETURN fof
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-expand-all.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+-----------------+-------------------------------------------+----------------+------+---------+----------------+---------------------+
| Operator        | Details                                   | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Other               |
+-----------------+-------------------------------------------+----------------+------+---------+----------------+---------------------+
| +ProduceResults | fof                                       |              0 |    1 |       0 |                | Fused in Pipeline 0 |
| |               +-------------------------------------------+----------------+------+---------+----------------+---------------------+
| +Expand(All)    | (p)-[anon_30:FRIENDS_WITH]->(fof)         |              0 |    1 |       3 |                | Fused in Pipeline 0 |
| |               +-------------------------------------------+----------------+------+---------+----------------+---------------------+
| +NodeIndexSeek  | p:Person(name) WHERE name = $autostring_0 |              1 |    1 |       2 |             72 | Fused in Pipeline 0 |
+-----------------+-------------------------------------------+----------------+------+---------+----------------+---------------------+

Total database accesses: 5, total allocated memory: 72

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/expand-all.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/expand-into.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-expand-into]]
== Expand Into ==
When both the start and end node have already been found, the `Expand(Into)` operator is used to find all relationships connecting the two nodes.
As both the start and end node of the relationship are already in scope, the node with the smallest degree will be used.
This can make a noticeable difference when dense nodes appear as end points.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-expand-into.query.asciidoc[]
[source,cypher]
----
MATCH (p:Person {name: 'me'})-[:FRIENDS_WITH]->(fof)-->(p) RETURN fof
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-expand-into.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+-----------------+-------------------------------------------+----------------+------+---------+----------------+---------------------+
| Operator        | Details                                   | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Other               |
+-----------------+-------------------------------------------+----------------+------+---------+----------------+---------------------+
| +ProduceResults | fof                                       |              0 |    0 |       0 |                | Fused in Pipeline 0 |
| |               +-------------------------------------------+----------------+------+---------+----------------+---------------------+
| +Filter         | not anon_30 = anon_53                     |              0 |    0 |       0 |                | Fused in Pipeline 0 |
| |               +-------------------------------------------+----------------+------+---------+----------------+---------------------+
| +Expand(Into)   | (p)-[anon_30:FRIENDS_WITH]->(fof)         |              0 |    0 |       0 |              0 | Fused in Pipeline 0 |
| |               +-------------------------------------------+----------------+------+---------+----------------+---------------------+
| +Expand(All)    | (p)<-[anon_53]-(fof)                      |              0 |    0 |       3 |                | Fused in Pipeline 0 |
| |               +-------------------------------------------+----------------+------+---------+----------------+---------------------+
| +NodeIndexSeek  | p:Person(name) WHERE name = $autostring_0 |              1 |    1 |       2 |             72 | Fused in Pipeline 0 |
+-----------------+-------------------------------------------+----------------+------+---------+----------------+---------------------+

Total database accesses: 5, total allocated memory: 72

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/expand-into.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/optional-expand-all.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-optional-expand-all]]
== Optional Expand All ==
The `OptionalExpand(All)` operator is analogous to xref:execution-plans/operators.adoc#query-plan-expand-all[Expand(All)], apart from when no relationships match the direction, type and property predicates.
In this situation, `OptionalExpand(all)` will return a single row with the relationship and end node set to `null`.


.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-optional-expand-all.query.asciidoc[]
[source,cypher]
----
MATCH (p:Person)
           OPTIONAL MATCH (p)-[works_in:WORKS_IN]->(l) WHERE works_in.duration > 180
           RETURN p, l
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-optional-expand-all.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+----------------------+-------------------------------------------------------------------+----------------+------+---------+----------------+---------------------+
| Operator             | Details                                                           | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Other               |
+----------------------+-------------------------------------------------------------------+----------------+------+---------+----------------+---------------------+
| +ProduceResults      | p, l                                                              |             14 |   15 |       1 |                | Fused in Pipeline 0 |
| |                    +-------------------------------------------------------------------+----------------+------+---------+----------------+---------------------+
| +OptionalExpand(All) | (p)-[works_in:WORKS_IN]->(l) WHERE works_in.duration > $autoint_0 |             14 |   15 |      47 |                | Fused in Pipeline 0 |
| |                    +-------------------------------------------------------------------+----------------+------+---------+----------------+---------------------+
| +NodeByLabelScan     | p:Person                                                          |             14 |   14 |      15 |             72 | Fused in Pipeline 0 |
+----------------------+-------------------------------------------------------------------+----------------+------+---------+----------------+---------------------+

Total database accesses: 63, total allocated memory: 72

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/optional-expand-all.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/optional-expand-into.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-optional-expand-into]]
== Optional Expand Into ==
The `OptionalExpand(Into)` operator is analogous to xref:execution-plans/operators.adoc#query-plan-expand-into[Expand(Into)], apart from when no matching relationships are found.
In this situation, `OptionalExpand(Into)` will return a single row with the relationship and end node set to `null`.
As both the start and end node of the relationship are already in scope, the node with the smallest degree will be used.
This can make a noticeable difference when dense nodes appear as end points.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-optional-expand-into.query.asciidoc[]
[source,cypher]
----
MATCH (p:Person)-[works_in:WORKS_IN]->(l) OPTIONAL MATCH (l)-->(p) RETURN p
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-optional-expand-into.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+-----------------------+------------------------------+----------------+------+---------+----------------+---------------------+
| Operator              | Details                      | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Other               |
+-----------------------+------------------------------+----------------+------+---------+----------------+---------------------+
| +ProduceResults       | p                            |             15 |   15 |       0 |                | Fused in Pipeline 0 |
| |                     +------------------------------+----------------+------+---------+----------------+---------------------+
| +OptionalExpand(Into) | (l)-[anon_61]->(p)           |             15 |   15 |     105 |           3360 | Fused in Pipeline 0 |
| |                     +------------------------------+----------------+------+---------+----------------+---------------------+
| +Expand(All)          | (p)-[works_in:WORKS_IN]->(l) |             15 |   15 |      33 |                | Fused in Pipeline 0 |
| |                     +------------------------------+----------------+------+---------+----------------+---------------------+
| +NodeByLabelScan      | p:Person                     |             14 |   14 |      15 |             72 | Fused in Pipeline 0 |
+-----------------------+------------------------------+----------------+------+---------+----------------+---------------------+

Total database accesses: 153, total allocated memory: 3360

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/optional-expand-into.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/varlength-expand-all.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-varlength-expand-all]]
== VarLength Expand All ==
Given a start node, the `VarLengthExpand(All)` operator will traverse variable-length relationships.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-varlength-expand-all.query.asciidoc[]
[source,cypher]
----
MATCH (p:Person)-[:FRIENDS_WITH *1..2]-(q:Person) RETURN p, q
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-varlength-expand-all.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+-----------------------+------------------------------------+----------------+------+---------+----------------+---------------------+
| Operator              | Details                            | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Other               |
+-----------------------+------------------------------------+----------------+------+---------+----------------+---------------------+
| +ProduceResults       | p, q                               |              4 |    6 |       0 |                | Fused in Pipeline 0 |
| |                     +------------------------------------+----------------+------+---------+----------------+---------------------+
| +Filter               | q:Person                           |              4 |    6 |       6 |                | Fused in Pipeline 0 |
| |                     +------------------------------------+----------------+------+---------+----------------+---------------------+
| +VarLengthExpand(All) | (p)-[anon_17:FRIENDS_WITH*..2]-(q) |              4 |    6 |      47 |            128 | Fused in Pipeline 0 |
| |                     +------------------------------------+----------------+------+---------+----------------+---------------------+
| +NodeByLabelScan      | p:Person                           |             14 |   14 |      15 |             72 | Fused in Pipeline 0 |
+-----------------------+------------------------------------+----------------+------+---------+----------------+---------------------+

Total database accesses: 68, total allocated memory: 128

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/varlength-expand-all.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/varlength-expand-into.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-varlength-expand-into]]
== VarLength Expand Into ==
When both the start and end node have already been found, the `VarLengthExpand(Into)` operator is used to find all variable-length relationships connecting the two nodes.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-varlength-expand-into.query.asciidoc[]
[source,cypher]
----
MATCH (p:Person)-[:FRIENDS_WITH *1..2]-(p:Person) RETURN p
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-varlength-expand-into.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+------------------------+------------------------------------+----------------+------+---------+----------------+---------------------+
| Operator               | Details                            | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Other               |
+------------------------+------------------------------------+----------------+------+---------+----------------+---------------------+
| +ProduceResults        | p                                  |              0 |    0 |       0 |                | Fused in Pipeline 0 |
| |                      +------------------------------------+----------------+------+---------+----------------+---------------------+
| +VarLengthExpand(Into) | (p)-[anon_17:FRIENDS_WITH*..2]-(p) |              0 |    0 |      47 |            128 | Fused in Pipeline 0 |
| |                      +------------------------------------+----------------+------+---------+----------------+---------------------+
| +NodeByLabelScan       | p:Person                           |             14 |   14 |      15 |             72 | Fused in Pipeline 0 |
+------------------------+------------------------------------+----------------+------+---------+----------------+---------------------+

Total database accesses: 62, total allocated memory: 128

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/varlength-expand-into.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/varlength-expand-pruning.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-varlength-expand-pruning]]
== VarLength Expand Pruning ==
Given a start node, the `VarLengthExpand(Pruning)` operator will traverse variable-length relationships much like the xref:execution-plans/operators.adoc#query-plan-varlength-expand-all[`VarLengthExpand(All)`] operator.
However, as an optimization, some paths will not be explored if they are guaranteed to produce an end node that has already been found (by means of a previous path traversal).
This will only be used in cases where the individual paths are not of interest.
This operator guarantees that all the end nodes produced will be unique.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-varlength-expand-pruning.query.asciidoc[]
[source,cypher]
----
MATCH (p:Person)-[:FRIENDS_WITH *3..4]-(q:Person) RETURN DISTINCT p, q
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-varlength-expand-pruning.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+---------------------------+------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------+
| Operator                  | Details                      | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Page Cache Hits/Misses | Time (ms) | Other         |
+---------------------------+------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------+
| +ProduceResults           | p, q                         |              0 |    0 |       0 |                |                    0/0 |     0.013 | In Pipeline 1 |
| |                         +------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------+
| +Distinct                 | p, q                         |              0 |    0 |       0 |            192 |                    0/0 |     0.767 | In Pipeline 1 |
| |                         +------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------+
| +Filter                   | q:Person                     |              0 |    0 |       0 |                |                    0/0 |     0.042 | In Pipeline 1 |
| |                         +------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------+
| +VarLengthExpand(Pruning) | (p)-[:FRIENDS_WITH*3..4]-(q) |              0 |    0 |      32 |            896 |                        |           | In Pipeline 1 |
| |                         +------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------+
| +NodeByLabelScan          | p:Person                     |             14 |   14 |      15 |             72 |                    2/0 |     0.090 | In Pipeline 0 |
+---------------------------+------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------+

Total database accesses: 47, total allocated memory: 1088

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/varlength-expand-pruning.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/assert-same-node.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-assert-same-node]]
== Assert Same Node ==
The `AssertSameNode` operator is used to ensure that no unique constraints are violated.
The example looks for the presence of a team with the supplied name and id, and if one does not exist,
it will be created. Owing to the existence of two unique constraints
on `:Team(name)` and `:Team(id)`, any node that would be found by the `UniqueIndexSeek`
must be the very same node, or the constraints would be violated.
        

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-assert-same-node.query.asciidoc[]
[source,cypher]
----
MERGE (t:Team {name: 'Engineering', id: 42})
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-assert-same-node.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime SLOTTED

Runtime version 4.2

+---------------------------------+------------------------------------------------+----------------+------+---------+------------------------+
| Operator                        | Details                                        | Estimated Rows | Rows | DB Hits | Page Cache Hits/Misses |
+---------------------------------+------------------------------------------------+----------------+------+---------+------------------------+
| +ProduceResults                 |                                                |              1 |    0 |       0 |                    0/0 |
| |                               +------------------------------------------------+----------------+------+---------+------------------------+
| +EmptyResult                    |                                                |              1 |    0 |       0 |                    0/0 |
| |                               +------------------------------------------------+----------------+------+---------+------------------------+
| +AntiConditionalApply           |                                                |              1 |    1 |       0 |                    0/0 |
| |\                              +------------------------------------------------+----------------+------+---------+------------------------+
| | +MergeCreateNode              | t                                              |              1 |    0 |       0 |                    0/0 |
| |                               +------------------------------------------------+----------------+------+---------+------------------------+
| +Optional                       |                                                |              1 |    1 |       0 |                    0/0 |
| |                               +------------------------------------------------+----------------+------+---------+------------------------+
| +AssertSameNode                 | t                                              |              0 |    1 |       0 |                    0/0 |
| |\                              +------------------------------------------------+----------------+------+---------+------------------------+
| | +NodeUniqueIndexSeek(Locking) | UNIQUE t:Team(id) WHERE id = $autoint_1        |              1 |    1 |       1 |                    0/1 |
| |                               +------------------------------------------------+----------------+------+---------+------------------------+
| +NodeUniqueIndexSeek(Locking)   | UNIQUE t:Team(name) WHERE name = $autostring_0 |              0 |    1 |       1 |                    0/1 |
+---------------------------------+------------------------------------------------+----------------+------+---------+------------------------+

Total database accesses: 2, total allocated memory: 0

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/assert-same-node.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/drop-result.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-drop-result]]
== Drop Result ==
The `DropResult` operator produces zero rows.
It is applied when it can be deduced through static analysis that the result of an expression will be empty, such as when a predicate guaranteed to return `false` (e.g. `1 > 5`) is used in a query.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-drop-result.query.asciidoc[]
[source,cypher]
----
CYPHER runtime=slotted
MATCH (p) WHERE false RETURN p
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-drop-result.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime SLOTTED

Runtime version 4.2

+-----------------+---------+----------------+------+---------+------------------------+
| Operator        | Details | Estimated Rows | Rows | DB Hits | Page Cache Hits/Misses |
+-----------------+---------+----------------+------+---------+------------------------+
| +ProduceResults | p       |              0 |    0 |       0 |                    0/0 |
| |               +---------+----------------+------+---------+------------------------+
| +DropResult     |         |              0 |    0 |       0 |                    0/0 |
| |               +---------+----------------+------+---------+------------------------+
| +AllNodesScan   | p       |             35 |    0 |       0 |                    0/0 |
+-----------------+---------+----------------+------+---------+------------------------+

Total database accesses: 0, total allocated memory: 0

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/drop-result.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/empty-result.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-empty-result]]
== Empty Result ==
The `EmptyResult` operator eagerly loads all incoming data and discards it.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-empty-result.query.asciidoc[]
[source,cypher]
----
CREATE (:Person)
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-empty-result.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime SLOTTED

Runtime version 4.2

+-----------------+-----------------+----------------+------+---------+------------------------+
| Operator        | Details         | Estimated Rows | Rows | DB Hits | Page Cache Hits/Misses |
+-----------------+-----------------+----------------+------+---------+------------------------+
| +ProduceResults |                 |              1 |    0 |       0 |                    0/0 |
| |               +-----------------+----------------+------+---------+------------------------+
| +EmptyResult    |                 |              1 |    0 |       0 |                    0/0 |
| |               +-----------------+----------------+------+---------+------------------------+
| +Create         | (anon_8:Person) |              1 |    1 |       1 |                    0/0 |
+-----------------+-----------------+----------------+------+---------+------------------------+

Total database accesses: 1, total allocated memory: 0

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/empty-result.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/produce-results.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-produce-results]]
== Produce Results ==
The `ProduceResults` operator prepares the result so that it is consumable by the user, such as transforming internal values to user values.
It is present in every single query that returns data to the user, and has little bearing on performance optimisation.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-produce-results.query.asciidoc[]
[source,cypher]
----
MATCH (n) RETURN n
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-produce-results.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+-----------------+---------+----------------+------+---------+----------------+---------------------+
| Operator        | Details | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Other               |
+-----------------+---------+----------------+------+---------+----------------+---------------------+
| +ProduceResults | n       |             35 |   35 |       0 |                | Fused in Pipeline 0 |
| |               +---------+----------------+------+---------+----------------+---------------------+
| +AllNodesScan   | n       |             35 |   35 |      36 |             72 | Fused in Pipeline 0 |
+-----------------+---------+----------------+------+---------+----------------+---------------------+

Total database accesses: 36, total allocated memory: 72

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/produce-results.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/load-csv.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-load-csv]]
== Load CSV ==
The `LoadCSV` operator loads data from a CSV source into the query.
It is used whenever the xref:clauses/load-csv.adoc[LOAD CSV] clause is used in a query.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-load-csv.query.asciidoc[]
[source,cypher]
----
LOAD CSV FROM 'https://neo4j.com/docs/cypher-refcard/3.3/csv/artists.csv' AS line RETURN line
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-load-csv.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime SLOTTED

Runtime version 4.2

+-----------------+---------+----------------+------+---------+------------------------+
| Operator        | Details | Estimated Rows | Rows | DB Hits | Page Cache Hits/Misses |
+-----------------+---------+----------------+------+---------+------------------------+
| +ProduceResults | line    |             10 |    4 |       0 |                    0/0 |
| |               +---------+----------------+------+---------+------------------------+
| +LoadCSV        | line    |             10 |    4 |       0 |                    0/0 |
+-----------------+---------+----------------+------+---------+------------------------+

Total database accesses: 0, total allocated memory: 0

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/load-csv.asciidoc[]


[[execution-plans-operators-hash-join-general]]
== Hash joins in general

Hash joins have two inputs: the build input and probe input.
The query planner assigns these roles so that the smaller of the two inputs is the build input.
The build input is pulled in eagerly, and is used to build a probe table.
Once this is complete, the probe table is checked for each row coming from the probe input side.


In query plans, the build input is always the left operator, and the probe input the right operator.

There are four hash join operators:

* xref:execution-plans/operators.adoc#query-plan-node-hash-join[NodeHashJoin]
* xref:execution-plans/operators.adoc#query-plan-value-hash-join[ValueHashJoin]
* xref:execution-plans/operators.adoc#query-plan-node-left-right-outer-hash-join[NodeLeftOuterHashJoin]
* xref:execution-plans/operators.adoc#query-plan-node-left-right-outer-hash-join[NodeRightOuterHashJoin]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/node-hash-join.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-node-hash-join]]
== Node Hash Join ==

The `NodeHashJoin` operator is a variation of the xref:execution-plans/operators.adoc#execution-plans-operators-hash-join-general[hash join].
`NodeHashJoin` executes the hash join on node ids.
As primitive types and arrays can be used, it can be done very efficiently.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-node-hash-join.query.asciidoc[]
[source,cypher]
----
MATCH (bob:Person {name:'Bob'})-[:WORKS_IN]->(loc)<-[:WORKS_IN]-(matt:Person {name:'Mattis'})
RETURN loc.name
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-node-hash-join.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+------------------+----------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| Operator         | Details                                      | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Page Cache Hits/Misses | Time (ms) | Other               |
+------------------+----------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +ProduceResults  | `loc.name`                                   |             10 |    0 |       0 |                |                    0/0 |     0.000 | In Pipeline 2       |
| |                +----------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +Projection      | loc.name AS `loc.name`                       |             10 |    0 |       0 |                |                    0/0 |     0.000 | In Pipeline 2       |
| |                +----------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +Filter          | not anon_32 = anon_51                        |             10 |    0 |       0 |                |                    0/0 |     0.000 | In Pipeline 2       |
| |                +----------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +NodeHashJoin    | loc                                          |             10 |    0 |       0 |            496 |                        |     0.016 | In Pipeline 2       |
| |\               +----------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| | +Expand(All)   | (matt)-[anon_51:WORKS_IN]->(loc)             |             19 |    0 |       0 |                |                        |           | Fused in Pipeline 1 |
| | |              +----------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| | +NodeIndexSeek | matt:Person(name) WHERE name = $autostring_1 |              1 |    0 |       1 |             72 |                        |           | Fused in Pipeline 1 |
| |                +----------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +Expand(All)     | (bob)-[anon_32:WORKS_IN]->(loc)              |             19 |    1 |       3 |                |                        |           | Fused in Pipeline 0 |
| |                +----------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +NodeIndexSeek   | bob:Person(name) WHERE name = $autostring_0  |              1 |    1 |       2 |             72 |                        |           | Fused in Pipeline 0 |
+------------------+----------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+

Total database accesses: 6, total allocated memory: 568

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/node-hash-join.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/value-hash-join.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-value-hash-join]]
== Value Hash Join ==
The `ValueHashJoin` operator is a variation of the xref:execution-plans/operators.adoc#execution-plans-operators-hash-join-general[hash join].
           This operator allows for arbitrary values to be used as the join key.
           It is most frequently used to solve predicates of the form: `n.prop1 = m.prop2` (i.e. equality predicates between two property columns).
        

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-value-hash-join.query.asciidoc[]
[source,cypher]
----
MATCH (p:Person),(q:Person)
WHERE p.age = q.age
RETURN p,q
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-value-hash-join.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+--------------------+---------------+----------------+------+---------+----------------+------------------------+-----------+---------------+
| Operator           | Details       | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Page Cache Hits/Misses | Time (ms) | Other         |
+--------------------+---------------+----------------+------+---------+----------------+------------------------+-----------+---------------+
| +ProduceResults    | p, q          |              0 |    0 |       0 |                |                    0/0 |     0.011 | In Pipeline 2 |
| |                  +---------------+----------------+------+---------+----------------+------------------------+-----------+---------------+
| +ValueHashJoin     | p.age = q.age |              0 |    0 |       0 |            432 |                    0/0 |     0.280 | In Pipeline 2 |
| |\                 +---------------+----------------+------+---------+----------------+------------------------+-----------+---------------+
| | +NodeByLabelScan | q:Person      |             14 |   14 |      15 |             72 |                    2/0 |     0.142 | In Pipeline 1 |
| |                  +---------------+----------------+------+---------+----------------+------------------------+-----------+---------------+
| +NodeByLabelScan   | p:Person      |             14 |   14 |      15 |             72 |                    2/0 |     0.146 | In Pipeline 0 |
+--------------------+---------------+----------------+------+---------+----------------+------------------------+-----------+---------------+

Total database accesses: 30, total allocated memory: 432

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/value-hash-join.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/node-left-right-outer-hash-join.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-node-left-right-outer-hash-join]]
== Node Left/Right Outer Hash Join ==

The `NodeLeftOuterHashJoin` and `NodeRightOuterHashJoin` operators are variations of the xref:execution-plans/operators.adoc#execution-plans-operators-hash-join-general[hash join].
The query below can be planned with either a left or a right outer join.
The decision depends on the cardinalities of the left-hand and right-hand sides; i.e. how many rows would be returned, respectively, for `(a:Person)` and `(a)-->(b:Person)`.
If `(a:Person)` returns fewer results than `(a)-->(b:Person)`, a left outer join -- indicated by `NodeLeftOuterHashJoin` -- is planned.
On the other hand, if `(a:Person)` returns more results than `(a)-->(b:Person)`, a right outer join -- indicated by `NodeRightOuterHashJoin` -- is planned instead.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-node-left-right-outer-hash-join.query.asciidoc[]
[source,cypher]
----
MATCH (a:Person)
OPTIONAL MATCH (a)-->(b:Person)
USING JOIN ON a
RETURN a.name, b.name
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-node-left-right-outer-hash-join.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+-------------------------+------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| Operator                | Details                                              | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Page Cache Hits/Misses | Time (ms) | Other               |
+-------------------------+------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +ProduceResults         | `a.name`, `b.name`                                   |             14 |   14 |       0 |                |                    0/0 |     0.286 | In Pipeline 2       |
| |                       +------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +Projection             | cache[a.name] AS `a.name`, cache[b.name] AS `b.name` |             14 |   14 |      24 |                |                    0/0 |     0.117 | In Pipeline 2       |
| |                       +------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +NodeRightOuterHashJoin | a                                                    |             14 |   14 |       0 |           1072 |                    0/0 |     0.577 | In Pipeline 2       |
| |\                      +------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| | +NodeByLabelScan      | a:Person                                             |             14 |   14 |      15 |             72 |                    2/0 |     0.288 | In Pipeline 1       |
| |                       +------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +CacheProperties        | cache[a.name], cache[b.name]                         |              2 |    2 |       6 |                |                        |           | Fused in Pipeline 0 |
| |                       +------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +Expand(All)            | (b)<-[anon_36]-(a)                                   |              2 |    2 |      33 |                |                        |           | Fused in Pipeline 0 |
| |                       +------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +NodeByLabelScan        | b:Person                                             |             14 |   14 |      15 |             72 |                        |           | Fused in Pipeline 0 |
+-------------------------+------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+

Total database accesses: 93, total allocated memory: 1072

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/node-left-right-outer-hash-join.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/triadic-selection.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-triadic-selection]]
== Triadic Selection ==
The `TriadicSelection` operator is used to solve triangular queries, such as the very
common 'find my friend-of-friends that are not already my friend'.
It does so by putting all the friends into a set, and uses the set to check if the
friend-of-friends are already connected to me.
The example finds the names of all friends of my friends that are not already my friends.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-triadic-selection.query.asciidoc[]
[source,cypher]
----
CYPHER runtime=slotted MATCH (me:Person)-[:FRIENDS_WITH]-()-[:FRIENDS_WITH]-(other)
WHERE NOT (me)-[:FRIENDS_WITH]-(other)
RETURN other.name
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-triadic-selection.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime SLOTTED

Runtime version 4.2

+-------------------+------------------------------------------+----------------+------+---------+------------------------+
| Operator          | Details                                  | Estimated Rows | Rows | DB Hits | Page Cache Hits/Misses |
+-------------------+------------------------------------------+----------------+------+---------+------------------------+
| +ProduceResults   | `other.name`                             |              0 |    2 |       0 |                    0/0 |
| |                 +------------------------------------------+----------------+------+---------+------------------------+
| +Projection       | other.name AS `other.name`               |              0 |    2 |       2 |                    2/0 |
| |                 +------------------------------------------+----------------+------+---------+------------------------+
| +TriadicSelection | WHERE NOT (me)--(other)                  |              0 |    2 |       0 |                    0/0 |
| |\                +------------------------------------------+----------------+------+---------+------------------------+
| | +Filter         | not anon_18 = anon_37                    |              0 |    2 |       0 |                    0/0 |
| | |               +------------------------------------------+----------------+------+---------+------------------------+
| | +Expand(All)    | (anon_35)-[anon_37:FRIENDS_WITH]-(other) |              0 |    6 |      14 |                    4/0 |
| | |               +------------------------------------------+----------------+------+---------+------------------------+
| | +Argument       | me, anon_18, anon_35                     |              4 |    4 |       0 |                    0/0 |
| |                 +------------------------------------------+----------------+------+---------+------------------------+
| +Expand(All)      | (me)-[anon_18:FRIENDS_WITH]-(anon_35)    |              4 |    4 |      33 |                   15/0 |
| |                 +------------------------------------------+----------------+------+---------+------------------------+
| +NodeByLabelScan  | me:Person                                |             14 |   14 |      15 |                    2/0 |
+-------------------+------------------------------------------+----------------+------+---------+------------------------+

Total database accesses: 64, total allocated memory: 0

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/triadic-selection.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/triadic-build.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-triadic-build]]
== Triadic Build ==
The `TriadicBuild` operator is used in conjunction with `TriadicFilter` to solve triangular queries, such as the very
common 'find my friend-of-friends that are not already my friend'. These two operators are specific to Pipelined
runtime and together perform the same logic as `TriadicSelection` does for other runtimes.
`TriadicBuild` builds a set of all friends, which is later used by `TriadicFilter`.
The example finds the names of all friends of my friends that are not already my friends.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-triadic-build.query.asciidoc[]
[source,cypher]
----
CYPHER runtime=pipelined MATCH (me:Person)-[:FRIENDS_WITH]-()-[:FRIENDS_WITH]-(other)
WHERE NOT (me)-[:FRIENDS_WITH]-(other)
RETURN other.name
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-triadic-build.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+------------------+------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| Operator         | Details                                  | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Page Cache Hits/Misses | Time (ms) | Other               |
+------------------+------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +ProduceResults  | `other.name`                             |              0 |    2 |       0 |                |                    0/0 |     0.126 | In Pipeline 3       |
| |                +------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +Projection      | other.name AS `other.name`               |              0 |    2 |       4 |                |                    2/0 |     0.089 | In Pipeline 3       |
| |                +------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +TriadicFilter   | WHERE NOT (me)--(other)                  |              0 |    2 |       0 |            808 |                    0/0 |     0.112 | In Pipeline 3       |
| |                +------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +Apply           |                                          |              0 |    2 |       0 |                |                    0/0 |           |                     |
| |\               +------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| | +Filter        | not anon_18 = anon_37                    |              0 |    2 |       0 |                |                        |           | Fused in Pipeline 2 |
| | |              +------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| | +Expand(All)   | (anon_35)-[anon_37:FRIENDS_WITH]-(other) |              0 |    6 |      14 |                |                        |           | Fused in Pipeline 2 |
| | |              +------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| | +Argument      | me, anon_18, anon_35                     |              4 |    4 |       0 |            192 |                        |           | Fused in Pipeline 2 |
| |                +------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +TriadicBuild    | (me)--(anon_35)                          |              4 |    4 |       0 |            328 |                    0/0 |     0.126 | In Pipeline 1       |
| |                +------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +Expand(All)     | (me)-[anon_18:FRIENDS_WITH]-(anon_35)    |              4 |    4 |      33 |                |                        |           | Fused in Pipeline 0 |
| |                +------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +NodeByLabelScan | me:Person                                |             14 |   14 |      15 |             72 |                        |           | Fused in Pipeline 0 |
+------------------+------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+

Total database accesses: 66, total allocated memory: 976

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/triadic-build.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/triadic-filter.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-triadic-filter]]
== Triadic Filter ==
The `TriadicFilter` operator is used in conjunction with `TriadicBuild` to solve triangular queries, such as the very
common 'find my friend-of-friends that are not already my friend'. These two operators are specific to Pipelined
runtime and together perform the same logic as `TriadicSelection` does for other runtimes.
`TriadicFilter` uses a set of friends previously built by `TriadicBuild` to check if the friend-of-friends are already connected to me.
The example finds the names of all friends of my friends that are not already my friends.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-triadic-filter.query.asciidoc[]
[source,cypher]
----
CYPHER runtime=pipelined MATCH (me:Person)-[:FRIENDS_WITH]-()-[:FRIENDS_WITH]-(other)
WHERE NOT (me)-[:FRIENDS_WITH]-(other)
RETURN other.name
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-triadic-filter.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+------------------+------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| Operator         | Details                                  | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Page Cache Hits/Misses | Time (ms) | Other               |
+------------------+------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +ProduceResults  | `other.name`                             |              0 |    2 |       0 |                |                    0/0 |     0.068 | In Pipeline 3       |
| |                +------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +Projection      | other.name AS `other.name`               |              0 |    2 |       4 |                |                    2/0 |     0.114 | In Pipeline 3       |
| |                +------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +TriadicFilter   | WHERE NOT (me)--(other)                  |              0 |    2 |       0 |            808 |                    0/0 |     0.455 | In Pipeline 3       |
| |                +------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +Apply           |                                          |              0 |    2 |       0 |                |                    0/0 |           |                     |
| |\               +------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| | +Filter        | not anon_18 = anon_37                    |              0 |    2 |       0 |                |                        |           | Fused in Pipeline 2 |
| | |              +------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| | +Expand(All)   | (anon_35)-[anon_37:FRIENDS_WITH]-(other) |              0 |    6 |      14 |                |                        |           | Fused in Pipeline 2 |
| | |              +------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| | +Argument      | me, anon_18, anon_35                     |              4 |    4 |       0 |            192 |                        |           | Fused in Pipeline 2 |
| |                +------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +TriadicBuild    | (me)--(anon_35)                          |              4 |    4 |       0 |            328 |                    0/0 |     1.354 | In Pipeline 1       |
| |                +------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +Expand(All)     | (me)-[anon_18:FRIENDS_WITH]-(anon_35)    |              4 |    4 |      33 |                |                        |           | Fused in Pipeline 0 |
| |                +------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +NodeByLabelScan | me:Person                                |             14 |   14 |      15 |             72 |                        |           | Fused in Pipeline 0 |
+------------------+------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+

Total database accesses: 66, total allocated memory: 976

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/triadic-filter.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/cartesian-product.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-cartesian-product]]
== Cartesian Product ==
The `CartesianProduct` operator produces a cartesian product of the two inputs -- each row coming from the left child operator will be combined with all the rows from the right child operator.
`CartesianProduct` generally exhibits bad performance and ought to be avoided if possible.
        

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-cartesian-product.query.asciidoc[]
[source,cypher]
----
MATCH (p:Person), (t:Team) RETURN p, t
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-cartesian-product.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+--------------------+----------+----------------+------+---------+----------------+------------------------+-----------+---------------+
| Operator           | Details  | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Page Cache Hits/Misses | Time (ms) | Other         |
+--------------------+----------+----------------+------+---------+----------------+------------------------+-----------+---------------+
| +ProduceResults    | p, t     |            140 |  140 |       0 |                |                    2/0 |     3.299 | In Pipeline 2 |
| |                  +----------+----------------+------+---------+----------------+------------------------+-----------+---------------+
| +CartesianProduct  |          |            140 |  140 |       0 |            288 |                    0/0 |     0.989 | In Pipeline 2 |
| |\                 +----------+----------------+------+---------+----------------+------------------------+-----------+---------------+
| | +NodeByLabelScan | p:Person |             14 |   14 |      15 |             88 |                    2/0 |     0.029 | In Pipeline 1 |
| |                  +----------+----------------+------+---------+----------------+------------------------+-----------+---------------+
| +NodeByLabelScan   | t:Team   |             10 |   10 |      11 |             72 |                    2/0 |     0.089 | In Pipeline 0 |
+--------------------+----------+----------------+------+---------+----------------+------------------------+-----------+---------------+

Total database accesses: 26, total allocated memory: 288

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/cartesian-product.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/foreach.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-foreach]]
== Foreach ==
The `Foreach` operator executes a nested loop between the left child operator and the right child operator.
 In an analogous manner to the xref:execution-plans/operators.adoc#query-plan-apply[Apply] operator, it takes a row from the left-hand side and, using the xref:execution-plans/operators.adoc#query-plan-argument[Argument] operator, provides it to the operator tree on the right-hand side.
 `Foreach` will yield all the rows coming in from the left-hand side; all results from the right-hand side are pulled in and discarded.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-foreach.query.asciidoc[]
[source,cypher]
----
FOREACH (value IN [1,2,3] |
CREATE (:Person {age: value})
)
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-foreach.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime SLOTTED

Runtime version 4.2

+-----------------+--------------------+----------------+------+---------+------------------------+
| Operator        | Details            | Estimated Rows | Rows | DB Hits | Page Cache Hits/Misses |
+-----------------+--------------------+----------------+------+---------+------------------------+
| +ProduceResults |                    |              1 |    0 |       0 |                    0/0 |
| |               +--------------------+----------------+------+---------+------------------------+
| +EmptyResult    |                    |              1 |    0 |       0 |                    0/0 |
| |               +--------------------+----------------+------+---------+------------------------+
| +Foreach        | value IN [1, 2, 3] |              1 |    1 |       0 |                    0/0 |
| |\              +--------------------+----------------+------+---------+------------------------+
| | +Create       | (anon_36:Person)   |              1 |    3 |       9 |                    0/0 |
| | |             +--------------------+----------------+------+---------+------------------------+
| | +Argument     | value              |              1 |    3 |       0 |                    0/0 |
| |               +--------------------+----------------+------+---------+------------------------+
| +EmptyRow       |                    |              1 |    1 |       0 |                    0/0 |
+-----------------+--------------------+----------------+------+---------+------------------------+

Total database accesses: 9, total allocated memory: 0

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/foreach.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/eager.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-eager]]
== Eager ==
For isolation purposes, the `Eager` operator ensures that operations affecting subsequent operations are executed fully for the whole dataset before continuing execution.
 Information from the stores is fetched in a lazy manner; i.e. the pattern matching might not be fully exhausted before updates are applied.
 To guarantee reasonable semantics, the query planner will insert `Eager` operators into the query plan to prevent updates from influencing pattern matching;
 this scenario is exemplified by the query below, where the `DELETE` clause influences the `MATCH` clause.
 The `Eager` operator can cause high memory usage when importing data or migrating graph structures.
 In such cases, the operations should be split into simpler steps; e.g. importing nodes and relationships separately.
 Alternatively, the records to be updated can be returned, followed by an update statement.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-eager.query.asciidoc[]
[source,cypher]
----
MATCH (a)-[r]-(b) DELETE r,a,b MERGE ()
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-eager.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime SLOTTED

Runtime version 4.2

+-------------------------+-------------+----------------+------+---------+----------------+------------------------+
| Operator                | Details     | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Page Cache Hits/Misses |
+-------------------------+-------------+----------------+------+---------+----------------+------------------------+
| +ProduceResults         |             |              1 |    0 |       0 |                |                    0/0 |
| |                       +-------------+----------------+------+---------+----------------+------------------------+
| +EmptyResult            |             |              1 |    0 |       0 |                |                    0/0 |
| |                       +-------------+----------------+------+---------+----------------+------------------------+
| +Apply                  |             |              1 |  504 |       0 |                |                    0/0 |
| |\                      +-------------+----------------+------+---------+----------------+------------------------+
| | +AntiConditionalApply |             |              1 |  504 |       0 |                |                    0/0 |
| | |\                    +-------------+----------------+------+---------+----------------+------------------------+
| | | +MergeCreateNode    | anon_38     |              1 |    0 |       0 |                |                    0/0 |
| | |                     +-------------+----------------+------+---------+----------------+------------------------+
| | +Optional             |             |             35 |  504 |       0 |                |                    0/0 |
| | |                     +-------------+----------------+------+---------+----------------+------------------------+
| | +AllNodesScan         | anon_38     |             35 |  504 |     540 |                |                    0/0 |
| |                       +-------------+----------------+------+---------+----------------+------------------------+
| +Eager                  |             |             36 |   36 |       0 |           7456 |                    0/0 |
| |                       +-------------+----------------+------+---------+----------------+------------------------+
| +Delete                 | b           |             36 |   36 |       9 |                |                    0/0 |
| |                       +-------------+----------------+------+---------+----------------+------------------------+
| +Delete                 | a           |             36 |   36 |      12 |                |                    1/0 |
| |                       +-------------+----------------+------+---------+----------------+------------------------+
| +Delete                 | r           |             36 |   36 |      18 |                |                   19/0 |
| |                       +-------------+----------------+------+---------+----------------+------------------------+
| +Eager                  |             |             36 |   36 |       0 |           7456 |                    0/0 |
| |                       +-------------+----------------+------+---------+----------------+------------------------+
| +Expand(All)            | (a)-[r]-(b) |             36 |   36 |      71 |                |                   22/0 |
| |                       +-------------+----------------+------+---------+----------------+------------------------+
| +AllNodesScan           | a           |             35 |   35 |      36 |                |                    1/0 |
+-------------------------+-------------+----------------+------+---------+----------------+------------------------+

Total database accesses: 686, total allocated memory: 14824

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/eager.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/eager-aggregation.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-eager-aggregation]]
== Eager Aggregation ==
The `EagerAggregation` operator evaluates a grouping expression and uses the result to group rows into different groupings.
For each of these groupings, `EagerAggregation` will then evaluate all aggregation functions and return the result.
To do this, `EagerAggregation`, as the name implies, needs to pull in all data eagerly from its source and build up state, which leads to increased memory pressure in the system.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-eager-aggregation.query.asciidoc[]
[source,cypher]
----
MATCH (l:Location)<-[:WORKS_IN]-(p:Person) RETURN l.name AS location, collect(p.name) AS people
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-eager-aggregation.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+-------------------+------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| Operator          | Details                                              | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Page Cache Hits/Misses | Time (ms) | Other               |
+-------------------+------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +ProduceResults   | location, people                                     |              4 |    6 |       0 |                |                    0/0 |     0.155 | In Pipeline 1       |
| |                 +------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +EagerAggregation | cache[l.name] AS location, collect(p.name) AS people |              4 |    6 |      30 |           2404 |                        |     0.068 | Fused in Pipeline 0 |
| |                 +------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +Filter           | p:Person                                             |             15 |   15 |      15 |                |                        |           | Fused in Pipeline 0 |
| |                 +------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +Expand(All)      | (l)<-[anon_19:WORKS_IN]-(p)                          |             15 |   15 |      26 |                |                        |           | Fused in Pipeline 0 |
| |                 +------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +CacheProperties  | cache[l.name]                                        |             10 |   10 |      20 |                |                        |           | Fused in Pipeline 0 |
| |                 +------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+
| +NodeByLabelScan  | l:Location                                           |             10 |   10 |      11 |             72 |                        |           | Fused in Pipeline 0 |
+-------------------+------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------------+

Total database accesses: 102, total allocated memory: 2404

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/eager-aggregation.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/ordered-aggregation.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-ordered-aggregation]]
== Ordered Aggregation ==
The `OrderedAggregation` operator is an optimization of the `EagerAggregation` operator that takes advantage of the ordering of the incoming rows.
This operator uses lazy evaluation and has a lower memory pressure in the system than the `EagerAggregation` operator.
        

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-ordered-aggregation.query.asciidoc[]
[source,cypher]
----
MATCH (p:Person) WHERE p.name STARTS WITH 'P' RETURN p.name, count(*) AS count
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-ordered-aggregation.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+-----------------------+--------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+------------+---------------+
| Operator              | Details                                                            | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Page Cache Hits/Misses | Time (ms) | Ordered by | Other         |
+-----------------------+--------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+------------+---------------+
| +ProduceResults       | `p.name`, count                                                    |              0 |    2 |       0 |                |                    0/0 |     0.080 | p.name ASC | In Pipeline 1 |
| |                     +--------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+------------+---------------+
| +OrderedAggregation   | cache[p.name] AS `p.name`, count(*) AS count                       |              0 |    2 |       0 |            208 |                    0/0 |     0.204 | p.name ASC | In Pipeline 1 |
| |                     +--------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+------------+---------------+
| +NodeIndexSeekByRange | p:Person(name) WHERE name STARTS WITH $autostring_0, cache[p.name] |              0 |    2 |       3 |             72 |                    0/1 |     0.306 | p.name ASC | In Pipeline 0 |
+-----------------------+--------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+------------+---------------+

Total database accesses: 3, total allocated memory: 208

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/ordered-aggregation.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/node-count-from-count-store.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-node-count-from-count-store]]
== Node Count From Count Store ==
The `NodeCountFromCountStore` operator uses the count store to answer questions about node counts.
 This is much faster than the `EagerAggregation` operator which achieves the same result by actually counting.
 However, as the count store only stores a limited range of combinations, `EagerAggregation` will still be used for more complex queries.
 For example, we can get counts for all nodes, and nodes with a label, but not nodes with more than one label.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-node-count-from-count-store.query.asciidoc[]
[source,cypher]
----
MATCH (p:Person) RETURN count(p) AS people
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-node-count-from-count-store.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+--------------------------+------------------------------+----------------+------+---------+----------------+---------------------+
| Operator                 | Details                      | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Other               |
+--------------------------+------------------------------+----------------+------+---------+----------------+---------------------+
| +ProduceResults          | people                       |              1 |    1 |       0 |                | Fused in Pipeline 0 |
| |                        +------------------------------+----------------+------+---------+----------------+---------------------+
| +NodeCountFromCountStore | count( (:Person) ) AS people |              1 |    1 |       1 |             72 | Fused in Pipeline 0 |
+--------------------------+------------------------------+----------------+------+---------+----------------+---------------------+

Total database accesses: 1, total allocated memory: 72

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/node-count-from-count-store.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/relationship-count-from-count-store.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-relationship-count-from-count-store]]
== Relationship Count From Count Store ==
The `RelationshipCountFromCountStore` operator uses the count store to answer questions about relationship counts.
 This is much faster than the `EagerAggregation` operator which achieves the same result by actually counting.
 However, as the count store only stores a limited range of combinations, `EagerAggregation` will still be used for more complex queries.
 For example, we can get counts for all relationships, relationships with a type, relationships with a label on one end, but not relationships with labels on both end nodes.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-relationship-count-from-count-store.query.asciidoc[]
[source,cypher]
----
MATCH (p:Person)-[r:WORKS_IN]->() RETURN count(r) AS jobs
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-relationship-count-from-count-store.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+----------------------------------+--------------------------------------------+----------------+------+---------+----------------+---------------------+
| Operator                         | Details                                    | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Other               |
+----------------------------------+--------------------------------------------+----------------+------+---------+----------------+---------------------+
| +ProduceResults                  | jobs                                       |              1 |    1 |       0 |                | Fused in Pipeline 0 |
| |                                +--------------------------------------------+----------------+------+---------+----------------+---------------------+
| +RelationshipCountFromCountStore | count( (:Person)-[:WORKS_IN]->() ) AS jobs |              1 |    1 |       1 |             72 | Fused in Pipeline 0 |
+----------------------------------+--------------------------------------------+----------------+------+---------+----------------+---------------------+

Total database accesses: 1, total allocated memory: 72

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/relationship-count-from-count-store.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/distinct.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-distinct]]
== Distinct ==
The `Distinct` operator removes duplicate rows from the incoming stream of rows.
To ensure only distinct elements are returned, `Distinct` will pull in data lazily from its source and build up state.
This may lead to increased memory pressure in the system.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-distinct.query.asciidoc[]
[source,cypher]
----
MATCH (l:Location)<-[:WORKS_IN]-(p:Person) RETURN DISTINCT l
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-distinct.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+------------------+-----------------------------+----------------+------+---------+----------------+---------------------+
| Operator         | Details                     | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Other               |
+------------------+-----------------------------+----------------+------+---------+----------------+---------------------+
| +ProduceResults  | l                           |             14 |    6 |       0 |                | Fused in Pipeline 0 |
| |                +-----------------------------+----------------+------+---------+----------------+---------------------+
| +Distinct        | l                           |             14 |    6 |       0 |            192 | Fused in Pipeline 0 |
| |                +-----------------------------+----------------+------+---------+----------------+---------------------+
| +Filter          | p:Person                    |             15 |   15 |      15 |                | Fused in Pipeline 0 |
| |                +-----------------------------+----------------+------+---------+----------------+---------------------+
| +Expand(All)     | (l)<-[anon_19:WORKS_IN]-(p) |             15 |   15 |      26 |                | Fused in Pipeline 0 |
| |                +-----------------------------+----------------+------+---------+----------------+---------------------+
| +NodeByLabelScan | l:Location                  |             10 |   10 |      11 |             72 | Fused in Pipeline 0 |
+------------------+-----------------------------+----------------+------+---------+----------------+---------------------+

Total database accesses: 52, total allocated memory: 192

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/distinct.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/ordered-distinct.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-ordered-distinct]]
== Ordered Distinct ==
The `OrderedDistinct` operator is an optimization of the `Distinct` operator that takes advantage of the ordering of the incoming rows.
This operator has a lower memory pressure in the system than the `Distinct` operator.
        

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-ordered-distinct.query.asciidoc[]
[source,cypher]
----
MATCH (p:Person) WHERE p.name STARTS WITH 'P' RETURN DISTINCT p.name
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-ordered-distinct.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+-----------------------+--------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+------------+---------------+
| Operator              | Details                                                            | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Page Cache Hits/Misses | Time (ms) | Ordered by | Other         |
+-----------------------+--------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+------------+---------------+
| +ProduceResults       | `p.name`                                                           |              0 |    2 |       0 |                |                    0/0 |     0.063 | p.name ASC | In Pipeline 0 |
| |                     +--------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+------------+---------------+
| +OrderedDistinct      | cache[p.name] AS `p.name`                                          |              0 |    2 |       0 |                |                    0/0 |     0.052 | p.name ASC | In Pipeline 0 |
| |                     +--------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+------------+---------------+
| +NodeIndexSeekByRange | p:Person(name) WHERE name STARTS WITH $autostring_0, cache[p.name] |              0 |    2 |       3 |             72 |                    0/1 |     0.260 | p.name ASC | In Pipeline 0 |
+-----------------------+--------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+------------+---------------+

Total database accesses: 3, total allocated memory: 72

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/ordered-distinct.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/filter.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-filter]]
== Filter ==
The `Filter` operator filters each row coming from the child operator, only passing through rows that evaluate the predicates to `true`.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-filter.query.asciidoc[]
[source,cypher]
----
MATCH (p:Person) WHERE p.name =~ '^a.*' RETURN p
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-filter.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+-----------------+--------------------------------------------------+----------------+------+---------+----------------+---------------------+
| Operator        | Details                                          | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Other               |
+-----------------+--------------------------------------------------+----------------+------+---------+----------------+---------------------+
| +ProduceResults | p                                                |             14 |    0 |       0 |                | Fused in Pipeline 0 |
| |               +--------------------------------------------------+----------------+------+---------+----------------+---------------------+
| +Filter         | cache[p.name] =~ $autostring_0                   |             14 |    0 |       0 |                | Fused in Pipeline 0 |
| |               +--------------------------------------------------+----------------+------+---------+----------------+---------------------+
| +NodeIndexScan  | p:Person(name) WHERE exists(name), cache[p.name] |             14 |   14 |      15 |             72 | Fused in Pipeline 0 |
+-----------------+--------------------------------------------------+----------------+------+---------+----------------+---------------------+

Total database accesses: 15, total allocated memory: 72

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/filter.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/limit.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-limit]]
== Limit ==
The `Limit` operator returns the first 'n' rows from the incoming input.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-limit.query.asciidoc[]
[source,cypher]
----
MATCH (p:Person) RETURN p LIMIT 3
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-limit.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+------------------+----------+----------------+------+---------+----------------+---------------------+
| Operator         | Details  | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Other               |
+------------------+----------+----------------+------+---------+----------------+---------------------+
| +ProduceResults  | p        |              3 |    3 |       0 |                | Fused in Pipeline 0 |
| |                +----------+----------------+------+---------+----------------+---------------------+
| +Limit           | 3        |              3 |    3 |       0 |                | Fused in Pipeline 0 |
| |                +----------+----------------+------+---------+----------------+---------------------+
| +NodeByLabelScan | p:Person |             14 |    4 |       5 |             72 | Fused in Pipeline 0 |
+------------------+----------+----------------+------+---------+----------------+---------------------+

Total database accesses: 5, total allocated memory: 72

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/limit.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/skip.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-skip]]
== Skip ==
The `Skip` operator skips 'n' rows from the incoming rows.
        

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-skip.query.asciidoc[]
[source,cypher]
----
MATCH (p:Person)
           RETURN p
           ORDER BY p.id
           SKIP 1
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-skip.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+------------------+----------------+----------------+------+---------+----------------+------------------------+-----------+------------+---------------------+
| Operator         | Details        | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Page Cache Hits/Misses | Time (ms) | Ordered by | Other               |
+------------------+----------------+----------------+------+---------+----------------+------------------------+-----------+------------+---------------------+
| +ProduceResults  | p              |             13 |   13 |       0 |                |                    2/0 |     2.405 | p.id ASC   | In Pipeline 1       |
| |                +----------------+----------------+------+---------+----------------+------------------------+-----------+------------+---------------------+
| +Skip            | $autoint_0     |             13 |   13 |       0 |                |                    0/0 |     0.022 | p.id ASC   | In Pipeline 1       |
| |                +----------------+----------------+------+---------+----------------+------------------------+-----------+------------+---------------------+
| +Sort            | `p.id` ASC     |             14 |   14 |       0 |            360 |                    0/0 |     0.147 | p.id ASC   | In Pipeline 1       |
| |                +----------------+----------------+------+---------+----------------+------------------------+-----------+------------+---------------------+
| +Projection      | p.id AS `p.id` |             14 |   14 |      28 |                |                        |           |            | Fused in Pipeline 0 |
| |                +----------------+----------------+------+---------+----------------+------------------------+-----------+------------+---------------------+
| +NodeByLabelScan | p:Person       |             14 |   14 |      15 |             72 |                        |           |            | Fused in Pipeline 0 |
+------------------+----------------+----------------+------+---------+----------------+------------------------+-----------+------------+---------------------+

Total database accesses: 43, total allocated memory: 360

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/skip.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/sort.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-sort]]
== Sort ==
The `Sort` operator sorts rows by a provided key.
In order to sort the data, all data from the source operator needs to be pulled in eagerly and kept in the query state, which will lead to increased memory pressure in the system.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-sort.query.asciidoc[]
[source,cypher]
----
MATCH (p:Person) RETURN p ORDER BY p.name
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-sort.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+------------------+--------------------+----------------+------+---------+----------------+------------------------+-----------+------------+---------------------+
| Operator         | Details            | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Page Cache Hits/Misses | Time (ms) | Ordered by | Other               |
+------------------+--------------------+----------------+------+---------+----------------+------------------------+-----------+------------+---------------------+
| +ProduceResults  | p                  |             14 |   14 |       0 |                |                    2/0 |     0.210 | p.name ASC | In Pipeline 1       |
| |                +--------------------+----------------+------+---------+----------------+------------------------+-----------+------------+---------------------+
| +Sort            | `p.name` ASC       |             14 |   14 |       0 |           1152 |                    0/0 |     0.147 | p.name ASC | In Pipeline 1       |
| |                +--------------------+----------------+------+---------+----------------+------------------------+-----------+------------+---------------------+
| +Projection      | p.name AS `p.name` |             14 |   14 |      28 |                |                        |           |            | Fused in Pipeline 0 |
| |                +--------------------+----------------+------+---------+----------------+------------------------+-----------+------------+---------------------+
| +NodeByLabelScan | p:Person           |             14 |   14 |      15 |             72 |                        |           |            | Fused in Pipeline 0 |
+------------------+--------------------+----------------+------+---------+----------------+------------------------+-----------+------------+---------------------+

Total database accesses: 43, total allocated memory: 1152

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/sort.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/partial-sort.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-partial-sort]]
== Partial Sort ==
The `PartialSort` operator is an optimization of the `Sort` operator that takes advantage of the ordering of the incoming rows.
This operator uses lazy evaluation and has a lower memory pressure in the system than the `Sort` operator.
Partial sort is only applicable when sorting on multiple columns.
        

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-partial-sort.query.asciidoc[]
[source,cypher]
----
MATCH (p:Person) WHERE p.name STARTS WITH 'P' RETURN p ORDER BY p.name, p.age
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-partial-sort.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+-----------------------+--------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+-----------------------+---------------------+
| Operator              | Details                                                            | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Page Cache Hits/Misses | Time (ms) | Ordered by            | Other               |
+-----------------------+--------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+-----------------------+---------------------+
| +ProduceResults       | p                                                                  |              0 |    2 |       0 |                |                    2/0 |     0.109 | p.name ASC, p.age ASC | In Pipeline 1       |
| |                     +--------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+-----------------------+---------------------+
| +PartialSort          | `p.name` ASC, `p.age` ASC                                          |              0 |    2 |       0 |            488 |                    0/0 |     0.127 | p.name ASC, p.age ASC | In Pipeline 1       |
| |                     +--------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+-----------------------+---------------------+
| +Projection           | cache[p.name] AS `p.name`, p.age AS `p.age`                        |              0 |    2 |       0 |                |                        |           | p.name ASC            | Fused in Pipeline 0 |
| |                     +--------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+-----------------------+---------------------+
| +NodeIndexSeekByRange | p:Person(name) WHERE name STARTS WITH $autostring_0, cache[p.name] |              0 |    2 |       3 |             72 |                        |           | p.name ASC            | Fused in Pipeline 0 |
+-----------------------+--------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+-----------------------+---------------------+

Total database accesses: 3, total allocated memory: 488

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/partial-sort.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/top.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-top]]
== Top ==
The `Top` operator returns the first 'n' rows sorted by a provided key. Instead of sorting the entire input, only the top 'n' rows are retained.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-top.query.asciidoc[]
[source,cypher]
----
MATCH (p:Person) RETURN p ORDER BY p.name LIMIT 2
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-top.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+------------------+----------------------+----------------+------+---------+----------------+------------------------+-----------+------------+---------------------+
| Operator         | Details              | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Page Cache Hits/Misses | Time (ms) | Ordered by | Other               |
+------------------+----------------------+----------------+------+---------+----------------+------------------------+-----------+------------+---------------------+
| +ProduceResults  | p                    |              2 |    2 |       0 |                |                    2/0 |     0.118 | p.name ASC | In Pipeline 1       |
| |                +----------------------+----------------+------+---------+----------------+------------------------+-----------+------------+---------------------+
| +Top             | `p.name` ASC LIMIT 2 |              2 |    2 |       0 |           1104 |                    0/0 |     0.092 | p.name ASC | In Pipeline 1       |
| |                +----------------------+----------------+------+---------+----------------+------------------------+-----------+------------+---------------------+
| +Projection      | p.name AS `p.name`   |             14 |   14 |      28 |                |                        |           |            | Fused in Pipeline 0 |
| |                +----------------------+----------------+------+---------+----------------+------------------------+-----------+------------+---------------------+
| +NodeByLabelScan | p:Person             |             14 |   14 |      15 |             72 |                        |           |            | Fused in Pipeline 0 |
+------------------+----------------------+----------------+------+---------+----------------+------------------------+-----------+------------+---------------------+

Total database accesses: 43, total allocated memory: 1104

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/top.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/partial-top.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-partial-top]]
== Partial Top ==
The `PartialTop` operator is an optimization of the `Top` operator that takes advantage of the ordering of the incoming rows.
This operator uses lazy evaluation and has a lower memory pressure in the system than the `Top` operator.
Partial top is only applicable when sorting on multiple columns.
        

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-partial-top.query.asciidoc[]
[source,cypher]
----
MATCH (p:Person) WHERE p.name STARTS WITH 'P' RETURN p ORDER BY p.name, p.age LIMIT 2
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-partial-top.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+-----------------------+--------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+-----------------------+---------------------+
| Operator              | Details                                                            | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Page Cache Hits/Misses | Time (ms) | Ordered by            | Other               |
+-----------------------+--------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+-----------------------+---------------------+
| +ProduceResults       | p                                                                  |              0 |    2 |       0 |                |                    2/0 |     0.190 | p.name ASC, p.age ASC | In Pipeline 1       |
| |                     +--------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+-----------------------+---------------------+
| +PartialTop           | `p.name` ASC, `p.age` ASC LIMIT 2                                  |              0 |    2 |       0 |            352 |                    0/0 |     1.156 | p.name ASC, p.age ASC | In Pipeline 1       |
| |                     +--------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+-----------------------+---------------------+
| +Projection           | cache[p.name] AS `p.name`, p.age AS `p.age`                        |              0 |    2 |       0 |                |                        |           | p.name ASC            | Fused in Pipeline 0 |
| |                     +--------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+-----------------------+---------------------+
| +NodeIndexSeekByRange | p:Person(name) WHERE name STARTS WITH $autostring_0, cache[p.name] |              0 |    2 |       3 |             72 |                        |           | p.name ASC            | Fused in Pipeline 0 |
+-----------------------+--------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+-----------------------+---------------------+

Total database accesses: 3, total allocated memory: 352

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/partial-top.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/union.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-union]]
== Union ==
The `Union` operator concatenates the results from the right child operator with the results from the left child operator.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-union.query.asciidoc[]
[source,cypher]
----
MATCH (p:Location)
           RETURN p.name
           UNION ALL
           MATCH (p:Country)
           RETURN p.name
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-union.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+--------------------+--------------------+----------------+------+---------+----------------+---------------------+
| Operator           | Details            | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Other               |
+--------------------+--------------------+----------------+------+---------+----------------+---------------------+
| +ProduceResults    | `p.name`           |             20 |   11 |       0 |                | Fused in Pipeline 2 |
| |                  +--------------------+----------------+------+---------+----------------+---------------------+
| +Union             |                    |             20 |   11 |       0 |            768 | Fused in Pipeline 2 |
| |\                 +--------------------+----------------+------+---------+----------------+---------------------+
| | +Projection      | `p.name`           |             10 |    1 |       0 |                | Fused in Pipeline 1 |
| | |                +--------------------+----------------+------+---------+----------------+---------------------+
| | +Projection      | p.name AS `p.name` |             10 |    1 |       2 |                | Fused in Pipeline 1 |
| | |                +--------------------+----------------+------+---------+----------------+---------------------+
| | +NodeByLabelScan | p:Country          |             10 |    1 |       2 |             72 | Fused in Pipeline 1 |
| |                  +--------------------+----------------+------+---------+----------------+---------------------+
| +Projection        | `p.name`           |             10 |   10 |       0 |                | Fused in Pipeline 0 |
| |                  +--------------------+----------------+------+---------+----------------+---------------------+
| +Projection        | p.name AS `p.name` |             10 |   10 |      20 |                | Fused in Pipeline 0 |
| |                  +--------------------+----------------+------+---------+----------------+---------------------+
| +NodeByLabelScan   | p:Location         |             10 |   10 |      11 |             72 | Fused in Pipeline 0 |
+--------------------+--------------------+----------------+------+---------+----------------+---------------------+

Total database accesses: 35, total allocated memory: 840

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/union.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/unwind.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-unwind]]
== Unwind ==
The `Unwind` operator returns one row per item in a list.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-unwind.query.asciidoc[]
[source,cypher]
----
UNWIND range(1, 5) as value return value
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-unwind.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+-----------------+----------------------------------------+----------------+------+---------+---------------------+
| Operator        | Details                                | Estimated Rows | Rows | DB Hits | Other               |
+-----------------+----------------------------------------+----------------+------+---------+---------------------+
| +ProduceResults | value                                  |             10 |    5 |       0 | Fused in Pipeline 0 |
| |               +----------------------------------------+----------------+------+---------+---------------------+
| +Unwind         | range($autoint_0, $autoint_1) AS value |             10 |    5 |       0 | Fused in Pipeline 0 |
+-----------------+----------------------------------------+----------------+------+---------+---------------------+

Total database accesses: 0, total allocated memory: 72

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/unwind.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/lock-nodes.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-lock-nodes]]
== Lock Nodes ==
The `LockNodes` operator locks the start and end node when creating a relationship.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-lock-nodes.query.asciidoc[]
[source,cypher]
----
MATCH (s:Person {name: 'me'}) MERGE (s)-[:FRIENDS_WITH]->(s)
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-lock-nodes.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime SLOTTED

Runtime version 4.2

+------------------------------+-------------------------------------------+----------------+------+---------+----------------+------------------------+
| Operator                     | Details                                   | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Page Cache Hits/Misses |
+------------------------------+-------------------------------------------+----------------+------+---------+----------------+------------------------+
| +ProduceResults              |                                           |              1 |    0 |       0 |                |                    0/0 |
| |                            +-------------------------------------------+----------------+------+---------+----------------+------------------------+
| +EmptyResult                 |                                           |              1 |    0 |       0 |                |                    0/0 |
| |                            +-------------------------------------------+----------------+------+---------+----------------+------------------------+
| +Apply                       |                                           |              1 |    1 |       0 |                |                    0/0 |
| |\                           +-------------------------------------------+----------------+------+---------+----------------+------------------------+
| | +AntiConditionalApply      |                                           |              1 |    1 |       0 |                |                    0/0 |
| | |\                         +-------------------------------------------+----------------+------+---------+----------------+------------------------+
| | | +MergeCreateRelationship | (s)-[anon_40:FRIENDS_WITH]->(s)           |              1 |    1 |       2 |                |                    2/0 |
| | | |                        +-------------------------------------------+----------------+------+---------+----------------+------------------------+
| | | +Argument                | s                                         |              1 |    1 |       0 |                |                    0/0 |
| | |                          +-------------------------------------------+----------------+------+---------+----------------+------------------------+
| | +AntiConditionalApply      |                                           |              1 |    1 |       0 |                |                    0/0 |
| | |\                         +-------------------------------------------+----------------+------+---------+----------------+------------------------+
| | | +Optional                | s                                         |              1 |    1 |       0 |                |                    0/0 |
| | | |                        +-------------------------------------------+----------------+------+---------+----------------+------------------------+
| | | +Expand(Into)            | (s)-[anon_40:FRIENDS_WITH]->(s)           |              0 |    0 |       4 |            896 |                    1/0 |
| | | |                        +-------------------------------------------+----------------+------+---------+----------------+------------------------+
| | | +LockNodes               | s                                         |              1 |    1 |       0 |                |                    0/0 |
| | | |                        +-------------------------------------------+----------------+------+---------+----------------+------------------------+
| | | +Argument                | s                                         |              1 |    1 |       0 |                |                    0/0 |
| | |                          +-------------------------------------------+----------------+------+---------+----------------+------------------------+
| | +Optional                  | s                                         |              1 |    1 |       0 |                |                    0/0 |
| | |                          +-------------------------------------------+----------------+------+---------+----------------+------------------------+
| | +Expand(Into)              | (s)-[anon_40:FRIENDS_WITH]->(s)           |              0 |    0 |       4 |            896 |                    2/0 |
| | |                          +-------------------------------------------+----------------+------+---------+----------------+------------------------+
| | +Argument                  | s                                         |              1 |    1 |       0 |                |                    0/0 |
| |                            +-------------------------------------------+----------------+------+---------+----------------+------------------------+
| +NodeIndexSeek               | s:Person(name) WHERE name = $autostring_0 |              1 |    1 |       2 |                |                    0/1 |
+------------------------------+-------------------------------------------+----------------+------+---------+----------------+------------------------+

Total database accesses: 12, total allocated memory: 896

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/lock-nodes.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/optional.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-optional]]
== Optional ==
The `Optional` operator is used to solve some xref:clauses/optional-match.adoc[OPTIONAL MATCH] queries.
It will pull data from its source, simply passing it through if any data exists.
However, if no data is returned by its source, `Optional` will yield a single row with all columns set to `null`.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-optional.query.asciidoc[]
[source,cypher]
----
MATCH (p:Person {name:'me'}) OPTIONAL MATCH (q:Person {name: 'Lulu'}) RETURN p, q
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-optional.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+------------------+-------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------+
| Operator         | Details                                   | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Page Cache Hits/Misses | Time (ms) | Other         |
+------------------+-------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------+
| +ProduceResults  | p, q                                      |              1 |    1 |       0 |                |                    2/0 |     0.102 | In Pipeline 2 |
| |                +-------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------+
| +Apply           |                                           |              1 |    1 |       0 |                |                    0/0 |     0.008 |               |
| |\               +-------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------+
| | +Optional      | p                                         |              1 |    1 |       0 |              0 |                    0/0 |     0.064 | In Pipeline 2 |
| | |              +-------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------+
| | +NodeIndexSeek | q:Person(name) WHERE name = $autostring_1 |              1 |    0 |       1 |             80 |                    1/0 |     0.064 | In Pipeline 1 |
| |                +-------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------+
| +NodeIndexSeek   | p:Person(name) WHERE name = $autostring_0 |              1 |    1 |       2 |             72 |                    0/1 |     0.186 | In Pipeline 0 |
+------------------+-------------------------------------------+----------------+------+---------+----------------+------------------------+-----------+---------------+

Total database accesses: 3, total allocated memory: 80

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/optional.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/project-endpoints.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-project-endpoints]]
== Project Endpoints ==
The `ProjectEndpoints` operator projects the start and end node of a relationship.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-project-endpoints.query.asciidoc[]
[source,cypher]
----
CREATE (n)-[p:KNOWS]->(m) WITH p AS r MATCH (u)-[r]->(v) RETURN u, v
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-project-endpoints.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime SLOTTED

Runtime version 4.2

+---------------------+------------------------------+----------------+------+---------+------------------------+
| Operator            | Details                      | Estimated Rows | Rows | DB Hits | Page Cache Hits/Misses |
+---------------------+------------------------------+----------------+------+---------+------------------------+
| +ProduceResults     | u, v                         |             18 |    1 |       0 |                    0/0 |
| |                   +------------------------------+----------------+------+---------+------------------------+
| +Apply              |                              |             18 |    1 |       0 |                    0/0 |
| |\                  +------------------------------+----------------+------+---------+------------------------+
| | +ProjectEndpoints | (u)-[r*]->(v)                |             18 |    1 |       0 |                    0/0 |
| | |                 +------------------------------+----------------+------+---------+------------------------+
| | +Argument         | r                            |              1 |    1 |       0 |                    0/0 |
| |                   +------------------------------+----------------+------+---------+------------------------+
| +Projection         | p AS r                       |              1 |    1 |       0 |                    0/0 |
| |                   +------------------------------+----------------+------+---------+------------------------+
| +Create             | (n), (m), (n)-[p:KNOWS]->(m) |              1 |    1 |       4 |                    0/0 |
+---------------------+------------------------------+----------------+------+---------+------------------------+

Total database accesses: 4, total allocated memory: 0

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/project-endpoints.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/projection.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-projection]]
== Projection ==
For each incoming row, the `Projection` operator evaluates a set of expressions and produces a row with the results of the expressions.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-projection.query.asciidoc[]
[source,cypher]
----
RETURN 'hello' AS greeting
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-projection.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+-----------------+---------------------------+----------------+------+---------+---------------------+
| Operator        | Details                   | Estimated Rows | Rows | DB Hits | Other               |
+-----------------+---------------------------+----------------+------+---------+---------------------+
| +ProduceResults | greeting                  |              1 |    1 |       0 | Fused in Pipeline 0 |
| |               +---------------------------+----------------+------+---------+---------------------+
| +Projection     | $autostring_0 AS greeting |              1 |    1 |       0 | Fused in Pipeline 0 |
+-----------------+---------------------------+----------------+------+---------+---------------------+

Total database accesses: 0, total allocated memory: 72

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/projection.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/empty-row.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-empty-row]]
== Empty Row ==
The `EmptyRow` operator returns a single row with no columns.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-empty-row.query.asciidoc[]
[source,cypher]
----
FOREACH (value IN [1,2,3] |
CREATE (:Person {age: value})
)
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-empty-row.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime SLOTTED

Runtime version 4.2

+-----------------+--------------------+----------------+------+---------+------------------------+
| Operator        | Details            | Estimated Rows | Rows | DB Hits | Page Cache Hits/Misses |
+-----------------+--------------------+----------------+------+---------+------------------------+
| +ProduceResults |                    |              1 |    0 |       0 |                    0/0 |
| |               +--------------------+----------------+------+---------+------------------------+
| +EmptyResult    |                    |              1 |    0 |       0 |                    0/0 |
| |               +--------------------+----------------+------+---------+------------------------+
| +Foreach        | value IN [1, 2, 3] |              1 |    1 |       0 |                    0/0 |
| |\              +--------------------+----------------+------+---------+------------------------+
| | +Create       | (anon_36:Person)   |              1 |    3 |       9 |                    0/0 |
| | |             +--------------------+----------------+------+---------+------------------------+
| | +Argument     | value              |              1 |    3 |       0 |                    0/0 |
| |               +--------------------+----------------+------+---------+------------------------+
| +EmptyRow       |                    |              1 |    1 |       0 |                    0/0 |
+-----------------+--------------------+----------------+------+---------+------------------------+

Total database accesses: 9, total allocated memory: 0

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/empty-row.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/procedure-call.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-procedure-call]]
== Procedure Call ==
The `ProcedureCall` operator indicates an invocation to a procedure.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-procedure-call.query.asciidoc[]
[source,cypher]
----
CALL db.labels() YIELD label RETURN * ORDER BY label
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-procedure-call.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+-----------------+-----------------------------------+----------------+------+---------+----------------+------------------------+-----------+------------+---------------------+
| Operator        | Details                           | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Page Cache Hits/Misses | Time (ms) | Ordered by | Other               |
+-----------------+-----------------------------------+----------------+------+---------+----------------+------------------------+-----------+------------+---------------------+
| +ProduceResults | label                             |             10 |    4 |       0 |                |                    0/0 |     0.064 | label ASC  | In Pipeline 1       |
| |               +-----------------------------------+----------------+------+---------+----------------+------------------------+-----------+------------+---------------------+
| +Sort           | label ASC                         |             10 |    4 |       0 |            496 |                    0/0 |     0.118 | label ASC  | In Pipeline 1       |
| |               +-----------------------------------+----------------+------+---------+----------------+------------------------+-----------+------------+---------------------+
| +ProcedureCall  | db.labels() :: (label :: STRING?) |             10 |    4 |         |                |                        |           |            | Fused in Pipeline 0 |
+-----------------+-----------------------------------+----------------+------+---------+----------------+------------------------+-----------+------------+---------------------+

Total database accesses: ?, total allocated memory: 496

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/procedure-call.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/cache-properties.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-cache-properties]]
== Cache Properties ==
The `CacheProperties` operator reads nodes and relationship properties and caches them in the current row.
Future accesses to these properties can avoid reading from the store which will speed up the query.
In the plan below we will cache `l.name` before `Expand(All)` where there are fewer rows.
      

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-cache-properties.query.asciidoc[]
[source,cypher]
----
MATCH (l:Location)<-[:WORKS_IN]-(p:Person) RETURN l.name AS location, p.name AS name
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-cache-properties.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime PIPELINED

Runtime version 4.2

+------------------+-------------------------------------------+----------------+------+---------+----------------+---------------------+
| Operator         | Details                                   | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Other               |
+------------------+-------------------------------------------+----------------+------+---------+----------------+---------------------+
| +ProduceResults  | location, name                            |             15 |   15 |       0 |                | Fused in Pipeline 0 |
| |                +-------------------------------------------+----------------+------+---------+----------------+---------------------+
| +Projection      | cache[l.name] AS location, p.name AS name |             15 |   15 |      30 |                | Fused in Pipeline 0 |
| |                +-------------------------------------------+----------------+------+---------+----------------+---------------------+
| +Filter          | p:Person                                  |             15 |   15 |      15 |                | Fused in Pipeline 0 |
| |                +-------------------------------------------+----------------+------+---------+----------------+---------------------+
| +Expand(All)     | (l)<-[anon_19:WORKS_IN]-(p)               |             15 |   15 |      26 |                | Fused in Pipeline 0 |
| |                +-------------------------------------------+----------------+------+---------+----------------+---------------------+
| +CacheProperties | cache[l.name]                             |             10 |   10 |      20 |                | Fused in Pipeline 0 |
| |                +-------------------------------------------+----------------+------+---------+----------------+---------------------+
| +NodeByLabelScan | l:Location                                |             10 |   10 |      11 |             72 | Fused in Pipeline 0 |
+------------------+-------------------------------------------+----------------+------+---------+----------------+---------------------+

Total database accesses: 102, total allocated memory: 72

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/cache-properties.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/create-nodes---relationships.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-create-nodes---relationships]]
== Create Nodes / Relationships ==
The `Create` operator is used to create nodes and relationships.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-create-nodes---relationships.query.asciidoc[]
[source,cypher]
----
CREATE (max:Person {name: 'Max'}), (chris:Person {name: 'Chris'})
CREATE (max)-[:FRIENDS_WITH]->(chris)
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-create-nodes---relationships.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime SLOTTED

Runtime version 4.2

+-----------------+---------------------------------------------------------------------+----------------+------+---------+------------------------+
| Operator        | Details                                                             | Estimated Rows | Rows | DB Hits | Page Cache Hits/Misses |
+-----------------+---------------------------------------------------------------------+----------------+------+---------+------------------------+
| +ProduceResults |                                                                     |              1 |    0 |       0 |                    0/0 |
| |               +---------------------------------------------------------------------+----------------+------+---------+------------------------+
| +EmptyResult    |                                                                     |              1 |    0 |       0 |                    0/0 |
| |               +---------------------------------------------------------------------+----------------+------+---------+------------------------+
| +Create         | (max:Person), (chris:Person), (max)-[anon_79:FRIENDS_WITH]->(chris) |              1 |    1 |       8 |                    0/0 |
+-----------------+---------------------------------------------------------------------+----------------+------+---------+------------------------+

Total database accesses: 8, total allocated memory: 0

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/create-nodes---relationships.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/delete.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-delete]]
== Delete ==
The `Delete` operator is used to delete a node or a relationship.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-delete.query.asciidoc[]
[source,cypher]
----
MATCH (me:Person {name: 'me'})-[w:WORKS_IN {duration: 190}]->(london:Location {name: 'London'})
DELETE w
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-delete.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime SLOTTED

Runtime version 4.2

+-----------------+-------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+
| Operator        | Details                                                           | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Page Cache Hits/Misses |
+-----------------+-------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+
| +ProduceResults |                                                                   |              0 |    0 |       0 |                |                    0/0 |
| |               +-------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+
| +EmptyResult    |                                                                   |              0 |    0 |       0 |                |                    0/0 |
| |               +-------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+
| +Delete         | w                                                                 |              0 |    1 |       1 |                |                    2/0 |
| |               +-------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+
| +Eager          |                                                                   |              0 |    1 |       0 |           4376 |                    0/0 |
| |               +-------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+
| +Filter         | me.name = $autostring_0 AND w.duration = $autoint_1 AND me:Person |              0 |    1 |       9 |                |                    3/0 |
| |               +-------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+
| +Expand(All)    | (london)<-[w:WORKS_IN]-(me)                                       |              0 |    7 |       9 |                |                    2/0 |
| |               +-------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+
| +NodeIndexSeek  | london:Location(name) WHERE name = $autostring_2                  |              0 |    1 |       2 |                |                    0/1 |
+-----------------+-------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+

Total database accesses: 21, total allocated memory: 4376

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/delete.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/detach-delete.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-detach-delete]]
== Detach Delete ==
The `DetachDelete` operator is used in all queries containing the xref:clauses/delete.adoc[DETACH DELETE] clause, when deleting nodes and their relationships.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-detach-delete.query.asciidoc[]
[source,cypher]
----
MATCH (p:Person)
DETACH DELETE p
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-detach-delete.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime SLOTTED

Runtime version 4.2

+------------------+----------+----------------+------+---------+------------------------+
| Operator         | Details  | Estimated Rows | Rows | DB Hits | Page Cache Hits/Misses |
+------------------+----------+----------------+------+---------+------------------------+
| +ProduceResults  |          |             14 |    0 |       0 |                    0/0 |
| |                +----------+----------------+------+---------+------------------------+
| +EmptyResult     |          |             14 |    0 |       0 |                    0/0 |
| |                +----------+----------------+------+---------+------------------------+
| +DetachDelete    | p        |             14 |   14 |       0 |                   48/0 |
| |                +----------+----------------+------+---------+------------------------+
| +NodeByLabelScan | p:Person |             14 |   14 |      15 |                    2/0 |
+------------------+----------+----------------+------+---------+------------------------+

Total database accesses: 15, total allocated memory: 0

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/detach-delete.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/merge-create-node.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-merge-create-node]]
== Merge Create Node ==
The `MergeCreateNode` operator is used when creating a node as a result of a xref:clauses/merge.adoc[MERGE] clause failing to find the node.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-merge-create-node.query.asciidoc[]
[source,cypher]
----
MERGE (:Person {name: 'Sally'})
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-merge-create-node.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime SLOTTED

Runtime version 4.2

+-----------------------+------------------------------------------------+----------------+------+---------+------------------------+
| Operator              | Details                                        | Estimated Rows | Rows | DB Hits | Page Cache Hits/Misses |
+-----------------------+------------------------------------------------+----------------+------+---------+------------------------+
| +ProduceResults       |                                                |              1 |    0 |       0 |                    0/0 |
| |                     +------------------------------------------------+----------------+------+---------+------------------------+
| +EmptyResult          |                                                |              1 |    0 |       0 |                    0/0 |
| |                     +------------------------------------------------+----------------+------+---------+------------------------+
| +AntiConditionalApply |                                                |              1 |    1 |       0 |                    0/0 |
| |\                    +------------------------------------------------+----------------+------+---------+------------------------+
| | +MergeCreateNode    | anon_7                                         |              1 |    1 |       3 |                    0/0 |
| |                     +------------------------------------------------+----------------+------+---------+------------------------+
| +Optional             |                                                |              1 |    1 |       0 |                    0/0 |
| |                     +------------------------------------------------+----------------+------+---------+------------------------+
| +NodeIndexSeek        | anon_7:Person(name) WHERE name = $autostring_0 |              1 |    0 |       1 |                    0/1 |
+-----------------------+------------------------------------------------+----------------+------+---------+------------------------+

Total database accesses: 4, total allocated memory: 0

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/merge-create-node.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/merge-create-relationship.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-merge-create-relationship]]
== Merge Create Relationship ==
The `MergeCreateRelationship` operator is used when creating a relationship as a result of a xref:clauses/merge.adoc[MERGE] clause failing to find the relationship.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-merge-create-relationship.query.asciidoc[]
[source,cypher]
----
MATCH (s:Person {name: 'Sally'})
MERGE (s)-[:FRIENDS_WITH]->(s)
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-merge-create-relationship.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime SLOTTED

Runtime version 4.2

+------------------------------+-------------------------------------------+----------------+------+---------+------------------------+
| Operator                     | Details                                   | Estimated Rows | Rows | DB Hits | Page Cache Hits/Misses |
+------------------------------+-------------------------------------------+----------------+------+---------+------------------------+
| +ProduceResults              |                                           |              1 |    0 |       0 |                    0/0 |
| |                            +-------------------------------------------+----------------+------+---------+------------------------+
| +EmptyResult                 |                                           |              1 |    0 |       0 |                    0/0 |
| |                            +-------------------------------------------+----------------+------+---------+------------------------+
| +Apply                       |                                           |              1 |    0 |       0 |                    0/0 |
| |\                           +-------------------------------------------+----------------+------+---------+------------------------+
| | +AntiConditionalApply      |                                           |              1 |    0 |       0 |                    0/0 |
| | |\                         +-------------------------------------------+----------------+------+---------+------------------------+
| | | +MergeCreateRelationship | (s)-[anon_43:FRIENDS_WITH]->(s)           |              1 |    0 |       0 |                    0/0 |
| | | |                        +-------------------------------------------+----------------+------+---------+------------------------+
| | | +Argument                | s                                         |              1 |    0 |       0 |                    0/0 |
| | |                          +-------------------------------------------+----------------+------+---------+------------------------+
| | +AntiConditionalApply      |                                           |              1 |    0 |       0 |                    0/0 |
| | |\                         +-------------------------------------------+----------------+------+---------+------------------------+
| | | +Optional                | s                                         |              1 |    0 |       0 |                    0/0 |
| | | |                        +-------------------------------------------+----------------+------+---------+------------------------+
| | | +Expand(Into)            | (s)-[anon_43:FRIENDS_WITH]->(s)           |              0 |    0 |       0 |                    0/0 |
| | | |                        +-------------------------------------------+----------------+------+---------+------------------------+
| | | +LockNodes               | s                                         |              1 |    0 |       0 |                    0/0 |
| | | |                        +-------------------------------------------+----------------+------+---------+------------------------+
| | | +Argument                | s                                         |              1 |    0 |       0 |                    0/0 |
| | |                          +-------------------------------------------+----------------+------+---------+------------------------+
| | +Optional                  | s                                         |              1 |    0 |       0 |                    0/0 |
| | |                          +-------------------------------------------+----------------+------+---------+------------------------+
| | +Expand(Into)              | (s)-[anon_43:FRIENDS_WITH]->(s)           |              0 |    0 |       0 |                    0/0 |
| | |                          +-------------------------------------------+----------------+------+---------+------------------------+
| | +Argument                  | s                                         |              1 |    0 |       0 |                    0/0 |
| |                            +-------------------------------------------+----------------+------+---------+------------------------+
| +NodeIndexSeek               | s:Person(name) WHERE name = $autostring_0 |              1 |    0 |       1 |                    0/1 |
+------------------------------+-------------------------------------------+----------------+------+---------+------------------------+

Total database accesses: 1, total allocated memory: 0

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/merge-create-relationship.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/set-labels.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-set-labels]]
== Set Labels ==
The `SetLabels` operator is used when setting labels on a node.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-set-labels.query.asciidoc[]
[source,cypher]
----
MATCH (n)
SET n:Person
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-set-labels.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime SLOTTED

Runtime version 4.2

+-----------------+----------+----------------+------+---------+------------------------+
| Operator        | Details  | Estimated Rows | Rows | DB Hits | Page Cache Hits/Misses |
+-----------------+----------+----------------+------+---------+------------------------+
| +ProduceResults |          |             35 |    0 |       0 |                    0/0 |
| |               +----------+----------------+------+---------+------------------------+
| +EmptyResult    |          |             35 |    0 |       0 |                    0/0 |
| |               +----------+----------------+------+---------+------------------------+
| +SetLabels      | n:Person |             35 |   35 |      35 |                    2/0 |
| |               +----------+----------------+------+---------+------------------------+
| +AllNodesScan   | n        |             35 |   35 |      36 |                    1/0 |
+-----------------+----------+----------------+------+---------+------------------------+

Total database accesses: 71, total allocated memory: 0

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/set-labels.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/remove-labels.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-remove-labels]]
== Remove Labels ==
The `RemoveLabels` operator is used when deleting labels from a node.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-remove-labels.query.asciidoc[]
[source,cypher]
----
MATCH (n)
REMOVE n:Person
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-remove-labels.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime SLOTTED

Runtime version 4.2

+-----------------+----------+----------------+------+---------+------------------------+
| Operator        | Details  | Estimated Rows | Rows | DB Hits | Page Cache Hits/Misses |
+-----------------+----------+----------------+------+---------+------------------------+
| +ProduceResults |          |             35 |    0 |       0 |                    0/0 |
| |               +----------+----------------+------+---------+------------------------+
| +EmptyResult    |          |             35 |    0 |       0 |                    0/0 |
| |               +----------+----------------+------+---------+------------------------+
| +RemoveLabels   | n:Person |             35 |   35 |      35 |                    2/0 |
| |               +----------+----------------+------+---------+------------------------+
| +AllNodesScan   | n        |             35 |   35 |      36 |                    1/0 |
+-----------------+----------+----------------+------+---------+------------------------+

Total database accesses: 71, total allocated memory: 0

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/remove-labels.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/set-node-properties-from-map.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-set-node-properties-from-map]]
== Set Node Properties From Map ==
The `SetNodePropertiesFromMap` operator is used when setting properties from a map on a node.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-set-node-properties-from-map.query.asciidoc[]
[source,cypher]
----
MATCH (n)
SET n = {weekday: 'Monday', meal: 'Lunch'}
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-set-node-properties-from-map.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime SLOTTED

Runtime version 4.2

+---------------------------+---------------------------------------------------+----------------+------+---------+------------------------+
| Operator                  | Details                                           | Estimated Rows | Rows | DB Hits | Page Cache Hits/Misses |
+---------------------------+---------------------------------------------------+----------------+------+---------+------------------------+
| +ProduceResults           |                                                   |             35 |    0 |       0 |                    0/0 |
| |                         +---------------------------------------------------+----------------+------+---------+------------------------+
| +EmptyResult              |                                                   |             35 |    0 |       0 |                    0/0 |
| |                         +---------------------------------------------------+----------------+------+---------+------------------------+
| +SetNodePropertiesFromMap | n = {weekday: $autostring_0, meal: $autostring_1} |             35 |   35 |     141 |                    4/0 |
| |                         +---------------------------------------------------+----------------+------+---------+------------------------+
| +AllNodesScan             | n                                                 |             35 |   35 |      36 |                    1/0 |
+---------------------------+---------------------------------------------------+----------------+------+---------+------------------------+

Total database accesses: 177, total allocated memory: 0

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/set-node-properties-from-map.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/set-relationship-properties-from-map.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-set-relationship-properties-from-map]]
== Set Relationship Properties From Map ==
The `SetRelationshipPropertiesFromMap` operator is used when setting properties from a map on a relationship.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-set-relationship-properties-from-map.query.asciidoc[]
[source,cypher]
----
MATCH (n)-[r]->(m)
SET r = {weight: 5, unit: 'kg'}
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-set-relationship-properties-from-map.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime SLOTTED

Runtime version 4.2

+-----------------------------------+-----------------------------------------------+----------------+------+---------+------------------------+
| Operator                          | Details                                       | Estimated Rows | Rows | DB Hits | Page Cache Hits/Misses |
+-----------------------------------+-----------------------------------------------+----------------+------+---------+------------------------+
| +ProduceResults                   |                                               |             18 |    0 |       0 |                    0/0 |
| |                                 +-----------------------------------------------+----------------+------+---------+------------------------+
| +EmptyResult                      |                                               |             18 |    0 |       0 |                    0/0 |
| |                                 +-----------------------------------------------+----------------+------+---------+------------------------+
| +SetRelationshipPropertiesFromMap | r = {weight: $autoint_0, unit: $autostring_1} |             18 |   18 |      69 |                    4/0 |
| |                                 +-----------------------------------------------+----------------+------+---------+------------------------+
| +Expand(All)                      | (m)<-[r]-(n)                                  |             18 |   18 |      71 |                   22/0 |
| |                                 +-----------------------------------------------+----------------+------+---------+------------------------+
| +AllNodesScan                     | m                                             |             35 |   35 |      36 |                    1/0 |
+-----------------------------------+-----------------------------------------------+----------------+------+---------+------------------------+

Total database accesses: 176, total allocated memory: 0

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/set-relationship-properties-from-map.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/set-property.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-set-property]]
== Set Property ==
The `SetProperty` operator is used when setting a property on a node or relationship.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-set-property.query.asciidoc[]
[source,cypher]
----
MATCH (n)
SET n.checked = true
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-set-property.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner COST

Runtime SLOTTED

Runtime version 4.2

+-----------------+------------------+----------------+------+---------+------------------------+
| Operator        | Details          | Estimated Rows | Rows | DB Hits | Page Cache Hits/Misses |
+-----------------+------------------+----------------+------+---------+------------------------+
| +ProduceResults |                  |             35 |    0 |       0 |                    0/0 |
| |               +------------------+----------------+------+---------+------------------------+
| +EmptyResult    |                  |             35 |    0 |       0 |                    0/0 |
| |               +------------------+----------------+------+---------+------------------------+
| +SetProperty    | n.checked = true |             35 |   35 |      38 |                    2/0 |
| |               +------------------+----------------+------+---------+------------------------+
| +AllNodesScan   | n                |             35 |   35 |      36 |                    1/0 |
+-----------------+------------------+----------------+------+---------+------------------------+

Total database accesses: 74, total allocated memory: 0

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/set-property.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/create-unique-constraint.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-create-unique-constraint]]
== Create Unique Constraint ==
The `CreateUniqueConstraint` operator creates a unique constraint on a property for all nodes having a certain label.
The following query will create a unique constraint with the name `uniqueness` on the `name` property of nodes with the `Country` label.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-create-unique-constraint.query.asciidoc[]
[source,cypher]
----
CREATE CONSTRAINT uniqueness ON (c:Country) ASSERT c.name is UNIQUE
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-create-unique-constraint.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner ADMINISTRATION

Runtime SCHEMA

Runtime version 4.2

+-------------------+----------------------------------------------------------------+
| Operator          | Details                                                        |
+-------------------+----------------------------------------------------------------+
| +CreateConstraint | CONSTRAINT uniqueness ON (c:Country) ASSERT (c.name) IS UNIQUE |
+-------------------+----------------------------------------------------------------+

Total database accesses: ?

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/create-unique-constraint.asciidoc[]

[role=deprecated]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/drop-unique-constraint.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-drop-unique-constraint]]
== Drop Unique Constraint ==
The `DropUniqueConstraint` operator removes a unique constraint from a property for all nodes having a certain label.
The following query will drop a unique constraint on the `name` property of nodes with the `Country` label.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-drop-unique-constraint.query.asciidoc[]
[source,cypher]
----
DROP CONSTRAINT ON (c:Country) ASSERT c.name is UNIQUE
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-drop-unique-constraint.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner ADMINISTRATION

Runtime SCHEMA

Runtime version 4.2

+-----------------+-----------------------------------------------------+
| Operator        | Details                                             |
+-----------------+-----------------------------------------------------+
| +DropConstraint | CONSTRAINT ON (c:Country) ASSERT (c.name) IS UNIQUE |
+-----------------+-----------------------------------------------------+

Total database accesses: ?

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/drop-unique-constraint.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/create-constraint-only-if-it-does-not-already-exist.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-create-constraint-only-if-it-does-not-already-exist]]
== Create Constraint only if it does not already exist ==
To not get an error creating the same constraint twice, we use the `DoNothingIfExists` operator for constraints.
This will make sure no other constraint with the given name or another constraint of the same type and schema already exists before the specific `CreateConstraint` operator creates the constraint.
If it finds a constraint with the given name or with the same type and schema it will stop the execution and no new constraint is created.
The following query will create a unique constraint with the name `uniqueness` on the `name` property of nodes with the `Country` label only if
no constraint named `uniqueness` or unique constraint on `(:Country \{name})` already exists.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-create-constraint-only-if-it-does-not-already-exist.query.asciidoc[]
[source,cypher]
----
CREATE CONSTRAINT uniqueness IF NOT EXISTS ON (c:Country) ASSERT c.name is UNIQUE
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-create-constraint-only-if-it-does-not-already-exist.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner ADMINISTRATION

Runtime SCHEMA

Runtime version 4.2

+--------------------------------+----------------------------------------------------------------+
| Operator                       | Details                                                        |
+--------------------------------+----------------------------------------------------------------+
| +CreateConstraint              | CONSTRAINT uniqueness ON (c:Country) ASSERT (c.name) IS UNIQUE |
| |                              +----------------------------------------------------------------+
| +DoNothingIfExists(CONSTRAINT) | CONSTRAINT uniqueness ON (c:Country) ASSERT (c.name) IS UNIQUE |
+--------------------------------+----------------------------------------------------------------+

Total database accesses: ?

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/create-constraint-only-if-it-does-not-already-exist.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/create-node-property-existence-constraint.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-create-node-property-existence-constraint]]
== Create Node Property Existence Constraint ==
The `CreateNodePropertyExistenceConstraint` operator creates an existence constraint with the name `existence` on a property for all nodes having a certain label.
This will only appear in Enterprise Edition.
        

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-create-node-property-existence-constraint.query.asciidoc[]
[source,cypher]
----
CREATE CONSTRAINT existence ON (p:Person) ASSERT exists(p.name)
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-create-node-property-existence-constraint.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner ADMINISTRATION

Runtime SCHEMA

Runtime version 4.2

+-------------------+----------------------------------------------------------+
| Operator          | Details                                                  |
+-------------------+----------------------------------------------------------+
| +CreateConstraint | CONSTRAINT existence ON (p:Person) ASSERT exists(p.name) |
+-------------------+----------------------------------------------------------+

Total database accesses: ?

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/create-node-property-existence-constraint.asciidoc[]

[role=deprecated]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/drop-node-property-existence-constraint.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-drop-node-property-existence-constraint]]
== Drop Node Property Existence Constraint ==
The `DropNodePropertyExistenceConstraint` operator removes an existence constraint from a property for all nodes having a certain label.
This will only appear in Enterprise Edition.
        

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-drop-node-property-existence-constraint.query.asciidoc[]
[source,cypher]
----
DROP CONSTRAINT ON (p:Person) ASSERT exists(p.name)
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-drop-node-property-existence-constraint.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner ADMINISTRATION

Runtime SCHEMA

Runtime version 4.2

+-----------------+------------------------------------------------+
| Operator        | Details                                        |
+-----------------+------------------------------------------------+
| +DropConstraint | CONSTRAINT ON (p:Person) ASSERT exists(p.name) |
+-----------------+------------------------------------------------+

Total database accesses: ?

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/drop-node-property-existence-constraint.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/create-node-key-constraint.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-create-node-key-constraint]]
== Create Node Key Constraint ==
The `CreateNodeKeyConstraint` operator creates a node key constraint with the name `node_key` which ensures
that all nodes with a particular label have a set of defined properties whose combined value is unique, and where all properties in the set are present.
This will only appear in Enterprise Edition.
        

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-create-node-key-constraint.query.asciidoc[]
[source,cypher]
----
CREATE CONSTRAINT node_key ON (e:Employee) ASSERT (e.firstname, e.surname) IS NODE KEY
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-create-node-key-constraint.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner ADMINISTRATION

Runtime SCHEMA

Runtime version 4.2

+-------------------+---------------------------------------------------------------------------------+
| Operator          | Details                                                                         |
+-------------------+---------------------------------------------------------------------------------+
| +CreateConstraint | CONSTRAINT node_key ON (e:Employee) ASSERT (e.firstname, e.surname) IS NODE KEY |
+-------------------+---------------------------------------------------------------------------------+

Total database accesses: ?

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/create-node-key-constraint.asciidoc[]

[role=deprecated]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/drop-node-key-constraint.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-drop-node-key-constraint]]
== Drop Node Key Constraint ==
The `DropNodeKeyConstraint` operator removes a node key constraint from a set of properties for all nodes having a certain label.
This will only appear in Enterprise Edition.
        

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-drop-node-key-constraint.query.asciidoc[]
[source,cypher]
----
DROP CONSTRAINT ON (e:Employee) ASSERT (e.firstname, e.surname) IS NODE KEY
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-drop-node-key-constraint.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner ADMINISTRATION

Runtime SCHEMA

Runtime version 4.2

+-----------------+------------------------------------------------------------------------+
| Operator        | Details                                                                |
+-----------------+------------------------------------------------------------------------+
| +DropConstraint | CONSTRAINT ON (e:Employee) ASSERT (e.firstname, e.surname) IS NODE KEY |
+-----------------+------------------------------------------------------------------------+

Total database accesses: ?

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/drop-node-key-constraint.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/create-relationship-property-existence-constraint.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-create-relationship-property-existence-constraint]]
== Create Relationship Property Existence Constraint ==
The `CreateRelationshipPropertyExistenceConstraint` operator creates an existence constraint with the name `existence` on a property for all relationships of a certain type.
This will only appear in Enterprise Edition.
        

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-create-relationship-property-existence-constraint.query.asciidoc[]
[source,cypher]
----
CREATE CONSTRAINT existence ON ()-[l:LIKED]-() ASSERT exists(l.when)
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-create-relationship-property-existence-constraint.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner ADMINISTRATION

Runtime SCHEMA

Runtime version 4.2

+-------------------+---------------------------------------------------------------+
| Operator          | Details                                                       |
+-------------------+---------------------------------------------------------------+
| +CreateConstraint | CONSTRAINT existence ON ()-[l:LIKED]-() ASSERT exists(l.when) |
+-------------------+---------------------------------------------------------------+

Total database accesses: ?

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/create-relationship-property-existence-constraint.asciidoc[]

[role=deprecated]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/drop-relationship-property-existence-constraint.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-drop-relationship-property-existence-constraint]]
== Drop Relationship Property Existence Constraint ==
The `DropRelationshipPropertyExistenceConstraint` operator removes an existence constraint from a property for all relationships of a certain type.
This will only appear in Enterprise Edition.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-drop-relationship-property-existence-constraint.query.asciidoc[]
[source,cypher]
----
DROP CONSTRAINT ON ()-[l:LIKED]-() ASSERT exists(l.when)
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-drop-relationship-property-existence-constraint.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner ADMINISTRATION

Runtime SCHEMA

Runtime version 4.2

+-----------------+-----------------------------------------------------+
| Operator        | Details                                             |
+-----------------+-----------------------------------------------------+
| +DropConstraint | CONSTRAINT ON ()-[l:LIKED]-() ASSERT exists(l.when) |
+-----------------+-----------------------------------------------------+

Total database accesses: ?

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/drop-relationship-property-existence-constraint.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/drop-constraint-by-name.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-drop-constraint-by-name]]
== Drop Constraint by name ==
The `DropConstraint` operator removes a constraint using the name of the constraint, no matter the type.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-drop-constraint-by-name.query.asciidoc[]
[source,cypher]
----
DROP CONSTRAINT name
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-drop-constraint-by-name.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner ADMINISTRATION

Runtime SCHEMA

Runtime version 4.2

+-----------------+-----------------+
| Operator        | Details         |
+-----------------+-----------------+
| +DropConstraint | CONSTRAINT name |
+-----------------+-----------------+

Total database accesses: ?

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/drop-constraint-by-name.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/list-constraints.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-list-constraints]]
== List constraints ==
The `ShowConstraints` operator lists constraints. It may include filtering on constraint type and can have either brief or verbose output.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-list-constraints.query.asciidoc[]
[source,cypher]
----
SHOW CONSTRAINTS
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-list-constraints.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner ADMINISTRATION

Runtime SCHEMA

Runtime version 4.2

+------------------+
| Operator         |
+------------------+
| +ShowConstraints |
+------------------+

Total database accesses: ?

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/list-constraints.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/create-index.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-create-index]]
== Create Index ==
The `CreateIndex` operator creates an index on a property for all nodes having a certain label.
The following query will create an index with the name `my_index` on the `name` property of nodes with the `Country` label.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-create-index.query.asciidoc[]
[source,cypher]
----
CREATE INDEX my_index FOR (c:Country) ON (c.name)
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-create-index.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner ADMINISTRATION

Runtime SCHEMA

Runtime version 4.2

+--------------+-----------------------------------------+
| Operator     | Details                                 |
+--------------+-----------------------------------------+
| +CreateIndex | INDEX my_index FOR (:Country) ON (name) |
+--------------+-----------------------------------------+

Total database accesses: ?

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/create-index.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/create-index-only-if-it-does-not-already-exist.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-create-index-only-if-it-does-not-already-exist]]
== Create Index only if it does not already exist ==
To not get an error creating the same index twice, we use the `DoNothingIfExists` operator for indexes.
This will make sure no other index with the given name or schema already exists before the `CreateIndex` operator creates an index on a property for all nodes having a certain label.
If it finds an index with the given name or schema it will stop the execution and no new index is created.
The following query will create an index with the name `my_index` on the `name` property of nodes with the `Country` label only if no such index already exists.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-create-index-only-if-it-does-not-already-exist.query.asciidoc[]
[source,cypher]
----
CREATE INDEX my_index IF NOT EXISTS FOR (c:Country) ON (c.name)
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-create-index-only-if-it-does-not-already-exist.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner ADMINISTRATION

Runtime SCHEMA

Runtime version 4.2

+---------------------------+-----------------------------------------+
| Operator                  | Details                                 |
+---------------------------+-----------------------------------------+
| +CreateIndex              | INDEX my_index FOR (:Country) ON (name) |
| |                         +-----------------------------------------+
| +DoNothingIfExists(INDEX) | INDEX my_index FOR (:Country) ON (name) |
+---------------------------+-----------------------------------------+

Total database accesses: ?

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/create-index-only-if-it-does-not-already-exist.asciidoc[]

[role=deprecated]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/drop-index-by-schema.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-drop-index-by-schema]]
== Drop Index by schema ==
The `DropIndex` operator removes an index from a property for all nodes having a certain label.
The following query will drop an index on the `name` property of nodes with the `Country` label.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-drop-index-by-schema.query.asciidoc[]
[source,cypher]
----
DROP INDEX ON :Country(name)
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-drop-index-by-schema.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner ADMINISTRATION

Runtime SCHEMA

Runtime version 4.2

+------------+--------------------------------+
| Operator   | Details                        |
+------------+--------------------------------+
| +DropIndex | INDEX FOR (:Country) ON (name) |
+------------+--------------------------------+

Total database accesses: ?

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/drop-index-by-schema.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/drop-index-by-name.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-drop-index-by-name]]
== Drop Index by name ==
The `DropIndex` operator removes an index using the name of the index.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-drop-index-by-name.query.asciidoc[]
[source,cypher]
----
DROP INDEX name
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-drop-index-by-name.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner ADMINISTRATION

Runtime SCHEMA

Runtime version 4.2

+------------+------------+
| Operator   | Details    |
+------------+------------+
| +DropIndex | INDEX name |
+------------+------------+

Total database accesses: ?

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/drop-index-by-name.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/list-indexes.asciidoc[]
// tag::include-neo4j-documentation[]
[[query-plan-list-indexes]]
== List indexes ==
The `ShowIndexes` operator lists indexes. It may include filtering on index type and can have either brief or verbose output.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-list-indexes.query.asciidoc[]
[source,cypher]
----
SHOW INDEXES BRIEF
----
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/includes/query-plan-list-indexes.query.asciidoc[]
// end::query[]



.Query Plan
[source]
----
Compiler CYPHER 4.2

Planner ADMINISTRATION

Runtime SCHEMA

Runtime version 4.2

+--------------+
| Operator     |
+--------------+
| +ShowIndexes |
+--------------+

Total database accesses: ?

----
// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/query-plan/list-indexes.asciidoc[]
