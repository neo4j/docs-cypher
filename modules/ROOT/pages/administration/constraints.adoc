[[administration-constraints]]
= Constraints
:description: This section explains how to manage constraints used for ensuring data integrity. 

* xref:administration/constraints.adoc#administration-constraints-introduction[Introduction]
* xref:administration/constraints.adoc#administration-constraints-syntax[Syntax]
* xref:administration/constraints.adoc#administration-constraints-examples[Examples]
** xref:administration/constraints.adoc#administration-constraints-unique-nodes[Unique node property constraints]
** xref:administration/constraints.adoc#administration-constraints-prop-exist-nodes[Node property existence constraints]
** xref:administration/constraints.adoc#administration-constraints-prop-exist-rels[Relationship property existence constraints]
** xref:administration/constraints.adoc#administration-constraints-node-key[Node key constraints]
** xref:administration/constraints.adoc#administration-constraints-drop-a-constraint[Drop a constraint]
** xref:administration/constraints.adoc#administration-constraints-list-constraints[List constraints]
** xref:administration/constraints.adoc#administration-constraints-deprecated-syntax[Deprecated syntax]

[[administration-constraints-introduction]]
== Introduction

The following constraint types are available:

*Unique node property constraints*::
Unique property constraints ensure that property values are unique for all nodes with a specific label.
Unique constraints do not mean that all nodes have to have a unique value for the properties -- nodes without the property are not subject to this rule.

*[enterprise-edition]#Node property existence constraints#*::
Node property existence constraints ensure that a property exists for all nodes with a specific label.
Queries that try to create new nodes of the specified label, but without this property, will fail.
The same is true for queries that try to remove the mandatory property.

*[enterprise-edition]#Relationship property existence constraints#*::
Property existence constraints ensure that a property exists for all relationships with a specific type.
All queries that try to create relationships of the specified type, but without this property, will fail.
The same is true for queries that try to remove the mandatory property.

*[enterprise-edition]#Node key constraints#*::
Node key constraints ensure that, for a given label and set of properties:
+
[lowerroman]
. All the properties exist on all the nodes with that label.
. The combination of the property values is unique.

+
Queries attempting to do any of the following will fail:

* Create new nodes without all the properties or where the combination of property values is not unique.
* Remove one of the mandatory properties.
* Update the properties so that the combination of property values is no longer unique.


[NOTE]
Unique node property constraints, node property existence constraints and relationship property existence constraints are only available in Neo4j Enterprise Edition.
Databases containing one of these constraint types cannot be opened using Neo4j Community Edition.

Creating a constraint has the following implications on indexes:

* Adding a unique property constraint on a property will also add a xref:administration/indexes-for-search-performance.adoc#administration-indexes-create-a-single-property-index[single-property index] on that property, so such an index cannot be added separately.
* Adding a node key constraint for a set of properties will also add a xref:administration/indexes-for-search-performance.adoc#administration-indexes-create-a-composite-index[composite index] on those properties, so such an index cannot be added separately.
* Cypher will use these indexes for lookups just like other indexes.
  Refer to xref:administration/indexes-for-search-performance.adoc[] for more details on indexes.
* If a unique property constraint is dropped and the single-property index on the property is still required, the index will need to be created explicitly.
* If a node key constraint is dropped and the composite-property index on the properties is still required, the index will need to be created explicitly.

Additionally, the following is true for constraints: 

* A given label can have multiple constraints, and unique and property existence constraints can be combined on the same property.
* Adding constraints is an atomic operation that can take a while -- all existing data has to be scanned before Neo4j can turn the constraint 'on'.
* Best practice is to give the constraint a name when it is created.
If the constraint is not explicitly named, it will get an auto-generated name.
* The constraint name must be unique among both indexes and constraints.
* Constraint creation is not idempotent.
An error will be thrown if you attempt to create the same constraint twice.

[[administration-constraints-syntax]]
== Syntax

.Syntax for managing indexes
[options="header", width="100%", cols="5a,3, 3a"]
|===
| Command | Description | Comment

| [source, cypher, role=noplay]
----
CREATE CONSTRAINT [constraint_name]
ON (n:LabelName) 
ASSERT n.propertyName IS UNIQUE
----
| Create a unique node property constraint.
.4+.^| Best practice is to give the constraint a name when it is created.
If the constraint is not explicitly named, it will get an auto-generated name.

The constraint name must be unique among both indexes and constraints.

Constraint creation is not idempotent.
An error will be thrown if you attempt to create the same constraint twice.
| [source, cypher, role=noplay]]
----
CREATE CONSTRAINT [constraint_name]
ON (n:LabelName) 
ASSERT EXISTS (n.propertyName)
----
| [enterprise-edition]#Create a node property existence constraint.#
| [source, cypher, role=noplay]
----
CREATE CONSTRAINT [constraint_name]
ON ()-"["R:RELATIONSHIP_TYPE"]"-()
ASSERT EXISTS (R.propertyName)
----
| [enterprise-edition]#Create a relationship property existence constraint.#
| [source, cypher, role=noplay]
----
CREATE CONSTRAINT [constraint_name]
ON (n:LabelName) 
ASSERT (n.propertyName_1,
n.propertyName_2,
…
n.propertyName_n)
IS NODE KEY
----
| [enterprise-edition]#Create a node key constraint.#
| [source, cypher, role=noplay]
----
DROP CONSTRAINT constraint_name
----
| Drop a constraint.
| 
| [source, cypher, role=noplay]
----
CALL db.constraints
----
| List all constraints in the database.
|
| [source, cypher, role=noplay]
----
DROP CONSTRAINT
ON (n:LabelName) 
ASSERT n.propertyName IS UNIQUE
----
| Drop a unique constraint without specifying a name.
.4+.^| [deprecated]#This syntax is deprecated.#
| [source, cypher, role=noplay]
----
DROP CONSTRAINT
ON (n:LabelName) 
ASSERT EXISTS (n.propertyName)
----
| Drop an exists constraint without specifying a name.
| [source, cypher, role=noplay]
----
DROP CONSTRAINT
ON ()-"["R:RELATIONSHIP_TYPE"]"-()
ASSERT EXISTS (R.propertyName)
----
| Drop a relationship property existence constraint without specifying a name.
| [source, cypher, role=noplay]
----
DROP CONSTRAINT
ON (n:LabelName) 
ASSERT (n.propertyName_1,
n.propertyName_2,
…
n.propertyName_n)
IS NODE KEY
----
| Drop a node key constraint without specifying a name.
|===

Creating a constraint requires xref:administration/security/administration.adoc#administration-security-administration-database-constraints[the `CREATE CONSTRAINT` privilege],
while dropping a constraint requires xref:administration/security/administration.adoc#administration-security-administration-database-constraints[the `DROP CONSTRAINT` privilege].
Listing constraints does not require any privileges.

[[administration-constraints-examples]]
== Examples

[[administration-constraints-unique-nodes]]
=== Unique node property constraints

// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/create-a-unique-constraint.asciidoc[]
// tag::include-neo4j-documentation[]
[[administration-constraints-create-a-unique-constraint]]
== Create a unique constraint ==
When creating a unique constraint, a name can be provided. The constraint ensures that your database will never contain more than one node with a specific label and one property value.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-unique-constraint.query.asciidoc[]
[source,cypher]
----
CREATE CONSTRAINT constraint_name ON (book:Book) ASSERT book.isbn IS UNIQUE
----
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-unique-constraint.query.asciidoc[]
// end::query[]


.Result
// tag::result[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-unique-constraint.result.asciidoc[]
[source, role="queryresult noheader"]
----
+-------------------+
| No data returned. |
+-------------------+
Unique constraints added: 1
----

// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-unique-constraint.result.asciidoc[]
// end::result[]



// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/create-a-unique-constraint.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/create-a-node-that-complies-with-unique-property-constraints.asciidoc[]
// tag::include-neo4j-documentation[]
[[administration-constraints-create-a-node-that-complies-with-unique-property-constraints]]
== Create a node that complies with unique property constraints ==
Create a `Book` node with an `isbn` that isn't already in the database.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-node-that-complies-with-unique-property-constraints.query.asciidoc[]
[source,cypher]
----
CREATE (book:Book {isbn: '1449356265', title: 'Graph Databases'})
----
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-node-that-complies-with-unique-property-constraints.query.asciidoc[]
// end::query[]


.Result
// tag::result[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-node-that-complies-with-unique-property-constraints.result.asciidoc[]
[source, role="queryresult noheader"]
----
+-------------------+
| No data returned. |
+-------------------+
Nodes created: 1
Properties set: 2
Labels added: 1
----

// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-node-that-complies-with-unique-property-constraints.result.asciidoc[]
// end::result[]

// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/create-a-node-that-complies-with-unique-property-constraints.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/create-a-node-that-violates-a-unique-property-constraint.asciidoc[]
// tag::include-neo4j-documentation[]
[[administration-constraints-create-a-node-that-violates-a-unique-property-constraint]]
== Create a node that violates a unique property constraint ==
Create a `Book` node with an `isbn` that is already used in the database.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-node-that-violates-a-unique-property-constraint.query.asciidoc[]
[source,cypher]
----
CREATE (book:Book {isbn: '1449356265', title: 'Graph Databases'})
----
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-node-that-violates-a-unique-property-constraint.query.asciidoc[]
// end::query[]


In this case the node isn't created in the graph.

.Error message
// tag::result[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-node-that-violates-a-unique-property-constraint.result.asciidoc[]
[source]
----
Node(0) already exists with label `Book` and property `isbn` = '1449356265'
----

// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-node-that-violates-a-unique-property-constraint.result.asciidoc[]
// end::result[]

// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/create-a-node-that-violates-a-unique-property-constraint.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/failure-to-create-a-unique-property-constraint-due-to-conflicting-nodes.asciidoc[]
// tag::include-neo4j-documentation[]
[[administration-constraints-failure-to-create-a-unique-property-constraint-due-to-conflicting-nodes]]
== Failure to create a unique property constraint due to conflicting nodes ==
Create a unique property constraint on the property `isbn` on nodes with the `Book` label when there are two nodes with the same `isbn`.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-failure-to-create-a-unique-property-constraint-due-to-conflicting-nodes.query.asciidoc[]
[source,cypher]
----
CREATE CONSTRAINT ON (book:Book) ASSERT book.isbn IS UNIQUE
----
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-failure-to-create-a-unique-property-constraint-due-to-conflicting-nodes.query.asciidoc[]
// end::query[]


In this case the constraint can't be created because it is violated by existing data. We may choose to use xref:administration/indexes-for-search-performance.adoc[] instead or remove the offending nodes and then re-apply the constraint.

.Error message
// tag::result[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-failure-to-create-a-unique-property-constraint-due-to-conflicting-nodes.result.asciidoc[]
[source]
----
Unable to create CONSTRAINT ON ( book:Book ) ASSERT (book.isbn) IS UNIQUE:
Both Node(0) and Node(1) have the label `Book` and property `isbn` = '1449356265'
----

// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-failure-to-create-a-unique-property-constraint-due-to-conflicting-nodes.result.asciidoc[]
// end::result[]

// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/failure-to-create-a-unique-property-constraint-due-to-conflicting-nodes.asciidoc[]


[role=enterprise-edition]
[[administration-constraints-prop-exist-nodes]]
=== Node property existence constraints

// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/create-a-node-property-existence-constraint.asciidoc[]
// tag::include-neo4j-documentation[]
[[administration-constraints-create-a-node-property-existence-constraint]]
== Create a node property existence constraint ==
When creating a node property existence constraint, a name can be provided. The constraint ensures that all nodes with a certain label have a certain property.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-node-property-existence-constraint.query.asciidoc[]
[source,cypher]
----
CREATE CONSTRAINT constraint_name ON (book:Book) ASSERT exists(book.isbn)
----
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-node-property-existence-constraint.query.asciidoc[]
// end::query[]


.Result
// tag::result[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-node-property-existence-constraint.result.asciidoc[]
[source, role="queryresult noheader"]
----
+-------------------+
| No data returned. |
+-------------------+
Property existence constraints added: 1
----

// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-node-property-existence-constraint.result.asciidoc[]
// end::result[]



// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/create-a-node-property-existence-constraint.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/create-a-node-that-complies-with-property-existence-constraints.asciidoc[]
// tag::include-neo4j-documentation[]
[[administration-constraints-create-a-node-that-complies-with-property-existence-constraints]]
== Create a node that complies with property existence constraints ==
Create a `Book` node with an `isbn` property.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-node-that-complies-with-property-existence-constraints.query.asciidoc[]
[source,cypher]
----
CREATE (book:Book {isbn: '1449356265', title: 'Graph Databases'})
----
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-node-that-complies-with-property-existence-constraints.query.asciidoc[]
// end::query[]


.Result
// tag::result[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-node-that-complies-with-property-existence-constraints.result.asciidoc[]
[source, role="queryresult noheader"]
----
+-------------------+
| No data returned. |
+-------------------+
Nodes created: 1
Properties set: 2
Labels added: 1
----

// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-node-that-complies-with-property-existence-constraints.result.asciidoc[]
// end::result[]

// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/create-a-node-that-complies-with-property-existence-constraints.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/create-a-node-that-violates-a-property-existence-constraint.asciidoc[]
// tag::include-neo4j-documentation[]
[[administration-constraints-create-a-node-that-violates-a-property-existence-constraint]]
== Create a node that violates a property existence constraint ==
Trying to create a `Book` node without an `isbn` property, given a property existence constraint on `:Book(isbn)`.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-node-that-violates-a-property-existence-constraint.query.asciidoc[]
[source,cypher]
----
CREATE (book:Book {title: 'Graph Databases'})
----
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-node-that-violates-a-property-existence-constraint.query.asciidoc[]
// end::query[]


In this case the node isn't created in the graph.

.Error message
// tag::result[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-node-that-violates-a-property-existence-constraint.result.asciidoc[]
[source]
----
Node(0) with label `Book` must have the property `isbn`
----

// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-node-that-violates-a-property-existence-constraint.result.asciidoc[]
// end::result[]

// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/create-a-node-that-violates-a-property-existence-constraint.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/removing-an-existence-constrained-node-property.asciidoc[]
// tag::include-neo4j-documentation[]
[[administration-constraints-removing-an-existence-constrained-node-property]]
== Removing an existence constrained node property ==
Trying to remove the `isbn` property from an existing node `book`, given a property existence constraint on `:Book(isbn)`.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-removing-an-existence-constrained-node-property.query.asciidoc[]
[source,cypher]
----
MATCH (book:Book {title: 'Graph Databases'}) REMOVE book.isbn
----
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-removing-an-existence-constrained-node-property.query.asciidoc[]
// end::query[]


In this case the property is not removed.

.Error message
// tag::result[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-removing-an-existence-constrained-node-property.result.asciidoc[]
[source]
----
Node(0) with label `Book` must have the property `isbn`
----

// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-removing-an-existence-constrained-node-property.result.asciidoc[]
// end::result[]

// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/removing-an-existence-constrained-node-property.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/failure-to-create-a-node-property-existence-constraint-due-to-existing-node.asciidoc[]
// tag::include-neo4j-documentation[]
[[administration-constraints-failure-to-create-a-node-property-existence-constraint-due-to-existing-node]]
== Failure to create a node property existence constraint due to existing node ==
Create a constraint on the property `isbn` on nodes with the `Book` label when there already exists  a node without an `isbn`.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-failure-to-create-a-node-property-existence-constraint-due-to-existing-node.query.asciidoc[]
[source,cypher]
----
CREATE CONSTRAINT ON (book:Book) ASSERT exists(book.isbn)
----
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-failure-to-create-a-node-property-existence-constraint-due-to-existing-node.query.asciidoc[]
// end::query[]


In this case the constraint can't be created because it is violated by existing data. We may choose to remove the offending nodes and then re-apply the constraint.

.Error message
// tag::result[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-failure-to-create-a-node-property-existence-constraint-due-to-existing-node.result.asciidoc[]
[source]
----
Unable to create CONSTRAINT ON ( book:Book ) ASSERT exists(book.isbn):
Node(0) with label `Book` must have the property `isbn`
----

// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-failure-to-create-a-node-property-existence-constraint-due-to-existing-node.result.asciidoc[]
// end::result[]

// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/failure-to-create-a-node-property-existence-constraint-due-to-existing-node.asciidoc[]


[role=enterprise-edition]
[[administration-constraints-prop-exist-rels]]
=== Relationship property existence constraints

// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/create-a-relationship-property-existence-constraint.asciidoc[]
// tag::include-neo4j-documentation[]
[[administration-constraints-create-a-relationship-property-existence-constraint]]
== Create a relationship property existence constraint ==
When creating a relationship property existence constraint, a name can be provided. The constraint ensures all relationships with a certain type have a certain property.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-relationship-property-existence-constraint.query.asciidoc[]
[source,cypher]
----
CREATE CONSTRAINT constraint_name ON ()-[like:LIKED]-() ASSERT exists(like.day)
----
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-relationship-property-existence-constraint.query.asciidoc[]
// end::query[]


.Result
// tag::result[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-relationship-property-existence-constraint.result.asciidoc[]
[source, role="queryresult noheader"]
----
+-------------------+
| No data returned. |
+-------------------+
Property existence constraints added: 1
----

// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-relationship-property-existence-constraint.result.asciidoc[]
// end::result[]



// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/create-a-relationship-property-existence-constraint.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/create-a-relationship-that-complies-with-property-existence-constraints.asciidoc[]
// tag::include-neo4j-documentation[]
[[administration-constraints-create-a-relationship-that-complies-with-property-existence-constraints]]
== Create a relationship that complies with property existence constraints ==
Create a `LIKED` relationship with a `day` property.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-relationship-that-complies-with-property-existence-constraints.query.asciidoc[]
[source,cypher]
----
CREATE (user:User)-[like:LIKED {day: 'yesterday'}]->(book:Book)
----
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-relationship-that-complies-with-property-existence-constraints.query.asciidoc[]
// end::query[]


.Result
// tag::result[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-relationship-that-complies-with-property-existence-constraints.result.asciidoc[]
[source, role="queryresult noheader"]
----
+-------------------+
| No data returned. |
+-------------------+
Nodes created: 2
Relationships created: 1
Properties set: 1
Labels added: 2
----

// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-relationship-that-complies-with-property-existence-constraints.result.asciidoc[]
// end::result[]

// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/create-a-relationship-that-complies-with-property-existence-constraints.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/create-a-relationship-that-violates-a-property-existence-constraint.asciidoc[]
// tag::include-neo4j-documentation[]
[[administration-constraints-create-a-relationship-that-violates-a-property-existence-constraint]]
== Create a relationship that violates a property existence constraint ==
Trying to create a `LIKED` relationship without a `day` property, given a property existence constraint `:LIKED(day)`.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-relationship-that-violates-a-property-existence-constraint.query.asciidoc[]
[source,cypher]
----
CREATE (user:User)-[like:LIKED]->(book:Book)
----
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-relationship-that-violates-a-property-existence-constraint.query.asciidoc[]
// end::query[]


In this case the relationship isn't created in the graph.

.Error message
// tag::result[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-relationship-that-violates-a-property-existence-constraint.result.asciidoc[]
[source]
----
Relationship(0) with type `LIKED` must have the property `day`
----

// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-relationship-that-violates-a-property-existence-constraint.result.asciidoc[]
// end::result[]

// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/create-a-relationship-that-violates-a-property-existence-constraint.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/removing-an-existence-constrained-relationship-property.asciidoc[]
// tag::include-neo4j-documentation[]
[[administration-constraints-removing-an-existence-constrained-relationship-property]]
== Removing an existence constrained relationship property ==
Trying to remove the `day` property from an existing relationship `like` of type `LIKED`, given a property existence constraint `:LIKED(day)`.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-removing-an-existence-constrained-relationship-property.query.asciidoc[]
[source,cypher]
----
MATCH (user:User)-[like:LIKED]->(book:Book) REMOVE like.day
----
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-removing-an-existence-constrained-relationship-property.query.asciidoc[]
// end::query[]


In this case the property is not removed.

.Error message
// tag::result[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-removing-an-existence-constrained-relationship-property.result.asciidoc[]
[source]
----
Relationship(0) with type `LIKED` must have the property `day`
----

// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-removing-an-existence-constrained-relationship-property.result.asciidoc[]
// end::result[]

// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/removing-an-existence-constrained-relationship-property.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/failure-to-create-a-relationship-property-existence-constraint-due-to-existing-relationship.asciidoc[]
// tag::include-neo4j-documentation[]
[[administration-constraints-failure-to-create-a-relationship-property-existence-constraint-due-to-existing-relationship]]
== Failure to create a relationship property existence constraint due to existing relationship ==
Create a constraint on the property `day` on relationships with the `LIKED` type when there already exists a relationship without a property named `day`.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-failure-to-create-a-relationship-property-existence-constraint-due-to-existing-relationship.query.asciidoc[]
[source,cypher]
----
CREATE CONSTRAINT ON ()-[like:LIKED]-() ASSERT exists(like.day)
----
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-failure-to-create-a-relationship-property-existence-constraint-due-to-existing-relationship.query.asciidoc[]
// end::query[]


In this case the constraint can't be created because it is violated by existing data. We may choose to remove the offending relationships and then re-apply the constraint.

.Error message
// tag::result[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-failure-to-create-a-relationship-property-existence-constraint-due-to-existing-relationship.result.asciidoc[]
[source]
----
Unable to create CONSTRAINT ON ()-[ liked:LIKED ]-() ASSERT exists(liked.day):
Relationship(0) with type `LIKED` must have the property `day`
----

// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-failure-to-create-a-relationship-property-existence-constraint-due-to-existing-relationship.result.asciidoc[]
// end::result[]

// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/failure-to-create-a-relationship-property-existence-constraint-due-to-existing-relationship.asciidoc[]


[role=enterprise-edition]
[[administration-constraints-node-key]]
=== Node key constraints

// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/create-a-node-key-constraint.asciidoc[]
// tag::include-neo4j-documentation[]
[[administration-constraints-create-a-node-key-constraint]]
== Create a node key constraint ==
When creating a node key constraint, a name can be provided. The constraint ensures that all nodes with a particular label have a set of defined properties whose combined value is unique and all properties in the set are present.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-node-key-constraint.query.asciidoc[]
[source,cypher]
----
CREATE CONSTRAINT constraint_name ON (n:Person) ASSERT (n.firstname, n.surname) IS NODE KEY
----
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-node-key-constraint.query.asciidoc[]
// end::query[]


.Result
// tag::result[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-node-key-constraint.result.asciidoc[]
[source, role="queryresult noheader"]
----
+-------------------+
| No data returned. |
+-------------------+
Node key constraints added: 1
----

// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-node-key-constraint.result.asciidoc[]
// end::result[]



// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/create-a-node-key-constraint.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/create-a-node-that-complies-with-node-key-constraints.asciidoc[]
// tag::include-neo4j-documentation[]
[[administration-constraints-create-a-node-that-complies-with-node-key-constraints]]
== Create a node that complies with node key constraints ==
Create a `Person` node with both a `firstname` and `surname` property.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-node-that-complies-with-node-key-constraints.query.asciidoc[]
[source,cypher]
----
CREATE (p:Person {firstname: 'John', surname: 'Wood', age: 55})
----
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-node-that-complies-with-node-key-constraints.query.asciidoc[]
// end::query[]


.Result
// tag::result[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-node-that-complies-with-node-key-constraints.result.asciidoc[]
[source, role="queryresult noheader"]
----
+-------------------+
| No data returned. |
+-------------------+
Nodes created: 1
Properties set: 3
Labels added: 1
----

// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-node-that-complies-with-node-key-constraints.result.asciidoc[]
// end::result[]

// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/create-a-node-that-complies-with-node-key-constraints.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/create-a-node-that-violates-a-node-key-constraint.asciidoc[]
// tag::include-neo4j-documentation[]
[[administration-constraints-create-a-node-that-violates-a-node-key-constraint]]
== Create a node that violates a node key constraint ==
Trying to create a `Person` node without a `surname` property, given a node key constraint on `:Person(firstname, surname)`, will fail.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-node-that-violates-a-node-key-constraint.query.asciidoc[]
[source,cypher]
----
CREATE (p:Person {firstname: 'Jane', age: 34})
----
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-node-that-violates-a-node-key-constraint.query.asciidoc[]
// end::query[]


In this case the node isn't created in the graph.

.Error message
// tag::result[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-node-that-violates-a-node-key-constraint.result.asciidoc[]
[source]
----
Node(0) with label `Person` must have the properties (firstname, surname)
----

// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-create-a-node-that-violates-a-node-key-constraint.result.asciidoc[]
// end::result[]

// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/create-a-node-that-violates-a-node-key-constraint.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/removing-a-node-key-constrained-property.asciidoc[]
// tag::include-neo4j-documentation[]
[[administration-constraints-removing-a-node-key-constrained-property]]
== Removing a `NODE KEY`-constrained property ==
Trying to remove the `surname` property from an existing node `Person`, given a `NODE KEY` constraint on `:Person(firstname, surname)`.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-removing-a-node-key-constrained-property.query.asciidoc[]
[source,cypher]
----
MATCH (p:Person {firstname: 'John', surname: 'Wood'}) REMOVE p.surname
----
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-removing-a-node-key-constrained-property.query.asciidoc[]
// end::query[]


In this case the property is not removed.

.Error message
// tag::result[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-removing-a-node-key-constrained-property.result.asciidoc[]
[source]
----
Node(0) with label `Person` must have the properties (firstname, surname)
----

// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-removing-a-node-key-constrained-property.result.asciidoc[]
// end::result[]

// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/removing-a-node-key-constrained-property.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/failure-to-create-a-node-key-constraint-due-to-existing-node.asciidoc[]
// tag::include-neo4j-documentation[]
[[administration-constraints-failure-to-create-a-node-key-constraint-due-to-existing-node]]
== Failure to create a node key constraint due to existing node ==
Trying to create a node key constraint on the property `surname` on nodes with the `Person` label will fail when  a node without a `surname` already exists in the database.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-failure-to-create-a-node-key-constraint-due-to-existing-node.query.asciidoc[]
[source,cypher]
----
CREATE CONSTRAINT ON (n:Person) ASSERT (n.firstname, n.surname) IS NODE KEY
----
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-failure-to-create-a-node-key-constraint-due-to-existing-node.query.asciidoc[]
// end::query[]


In this case the node key constraint can't be created because it is violated by existing data. We may choose to remove the offending nodes and then re-apply the constraint.

.Error message
// tag::result[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-failure-to-create-a-node-key-constraint-due-to-existing-node.result.asciidoc[]
[source]
----
Unable to create CONSTRAINT ON ( person:Person ) ASSERT exists(person.firstname,
person.surname):
Node(0) with label `Person` must have the properties (firstname, surname)
----

// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-failure-to-create-a-node-key-constraint-due-to-existing-node.result.asciidoc[]
// end::result[]

// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/failure-to-create-a-node-key-constraint-due-to-existing-node.asciidoc[]

//=== Drop a constraint
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/drop-a-constraint.asciidoc[]
// tag::include-neo4j-documentation[]
[[administration-constraints-drop-a-constraint]]
== Drop a constraint ==
A constraint can be dropped using the name with the `DROP CONSTRAINT constraint_name` command. It is the same command for unique property, property existence and node key constraints.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-drop-a-constraint.query.asciidoc[]
[source,cypher]
----
DROP CONSTRAINT constraint_name
----
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-drop-a-constraint.query.asciidoc[]
// end::query[]


.Result
// tag::result[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-drop-a-constraint.result.asciidoc[]
[source, role="queryresult noheader"]
----
+-------------------+
| No data returned. |
+-------------------+
Named constraints removed: 1
----

// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-drop-a-constraint.result.asciidoc[]
// end::result[]

// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/drop-a-constraint.asciidoc[]

//=== List constraints
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/list-constraints.asciidoc[]
// tag::include-neo4j-documentation[]
[[administration-constraints-list-constraints]]
== List constraints ==
Calling the built-in procedure `db.constraints` will list all constraints, including their names.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-list-constraints.query.asciidoc[]
[source,cypher]
----
CALL db.constraints
----
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-list-constraints.query.asciidoc[]
// end::query[]


.Result
// tag::result[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-list-constraints.result.asciidoc[]
[source, role="queryresult noheader"]
----
+------------------------------------------------------------------------------------+
| name                  | description                                                |
+------------------------------------------------------------------------------------+
| "constraint_ca412c3d" | "CONSTRAINT ON ( book:Book ) ASSERT (book.isbn) IS UNIQUE" |
+------------------------------------------------------------------------------------+
1 row
----

// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-list-constraints.result.asciidoc[]
// end::result[]

// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/list-constraints.asciidoc[]


[role=deprecated]
[[administration-constraints-deprecated-syntax]]
=== Deprecated syntax

// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/drop-a-unique-constraint.asciidoc[]
// tag::include-neo4j-documentation[]
[[administration-constraints-drop-a-unique-constraint]]
== Drop a unique constraint ==
By using `DROP CONSTRAINT`, you remove a constraint from the database.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-drop-a-unique-constraint.query.asciidoc[]
[source,cypher]
----
DROP CONSTRAINT ON (book:Book) ASSERT book.isbn IS UNIQUE
----
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-drop-a-unique-constraint.query.asciidoc[]
// end::query[]


.Result
// tag::result[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-drop-a-unique-constraint.result.asciidoc[]
[source, role="queryresult noheader"]
----
+-------------------+
| No data returned. |
+-------------------+
Unique constraints removed: 1
----

// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-drop-a-unique-constraint.result.asciidoc[]
// end::result[]

// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/drop-a-unique-constraint.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/drop-a-node-property-existence-constraint.asciidoc[]
// tag::include-neo4j-documentation[]
[[administration-constraints-drop-a-node-property-existence-constraint]]
== Drop a node property existence constraint ==
By using `DROP CONSTRAINT`, you remove a constraint from the database.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-drop-a-node-property-existence-constraint.query.asciidoc[]
[source,cypher]
----
DROP CONSTRAINT ON (book:Book) ASSERT exists(book.isbn)
----
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-drop-a-node-property-existence-constraint.query.asciidoc[]
// end::query[]


.Result
// tag::result[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-drop-a-node-property-existence-constraint.result.asciidoc[]
[source, role="queryresult noheader"]
----
+-------------------+
| No data returned. |
+-------------------+
Property existence constraints removed: 1
----

// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-drop-a-node-property-existence-constraint.result.asciidoc[]
// end::result[]

// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/drop-a-node-property-existence-constraint.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/drop-a-relationship-property-existence-constraint.asciidoc[]
// tag::include-neo4j-documentation[]
[[administration-constraints-drop-a-relationship-property-existence-constraint]]
== Drop a relationship property existence constraint ==
To remove a constraint from the database, use `DROP CONSTRAINT`.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-drop-a-relationship-property-existence-constraint.query.asciidoc[]
[source,cypher]
----
DROP CONSTRAINT ON ()-[like:LIKED]-() ASSERT exists(like.day)
----
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-drop-a-relationship-property-existence-constraint.query.asciidoc[]
// end::query[]


.Result
// tag::result[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-drop-a-relationship-property-existence-constraint.result.asciidoc[]
[source, role="queryresult noheader"]
----
+-------------------+
| No data returned. |
+-------------------+
Property existence constraints removed: 1
----

// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-drop-a-relationship-property-existence-constraint.result.asciidoc[]
// end::result[]

// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/drop-a-relationship-property-existence-constraint.asciidoc[]

// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/drop-a-node-key-constraint.asciidoc[]
// tag::include-neo4j-documentation[]
[[administration-constraints-drop-a-node-key-constraint]]
== Drop a node key constraint ==
Use `DROP CONSTRAINT` to remove a node key constraint from the database.

.Query
// tag::query[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-drop-a-node-key-constraint.query.asciidoc[]
[source,cypher]
----
DROP CONSTRAINT ON (n:Person) ASSERT (n.firstname, n.surname) IS NODE KEY
----
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-drop-a-node-key-constraint.query.asciidoc[]
// end::query[]


.Result
// tag::result[]
// tag::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-drop-a-node-key-constraint.result.asciidoc[]
[source, role="queryresult noheader"]
----
+-------------------+
| No data returned. |
+-------------------+
Node key constraints removed: 1
----

// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/includes/administration-constraints-drop-a-node-key-constraint.result.asciidoc[]
// end::result[]

// end::include-neo4j-documentation[]
// end::neo4j-cypher-docs/docs/dev/ql/administration/constraints/drop-a-node-key-constraint.asciidoc[]
